"use strict";var It=Object.create;var W=Object.defineProperty;var Ot=Object.getOwnPropertyDescriptor;var Rt=Object.getOwnPropertyNames;var $t=Object.getPrototypeOf,Ut=Object.prototype.hasOwnProperty;var h=(s,e)=>()=>(e||s((e={exports:{}}).exports,e),e.exports),Lt=(s,e)=>{for(var r in e)W(s,r,{get:e[r],enumerable:!0})},Ie=(s,e,r,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of Rt(e))!Ut.call(s,a)&&a!==r&&W(s,a,{get:()=>e[a],enumerable:!(t=Ot(e,a))||t.enumerable});return s};var m=(s,e,r)=>(r=s!=null?It($t(s)):{},Ie(e||!s||!s.__esModule?W(r,"default",{value:s,enumerable:!0}):r,s)),Bt=s=>Ie(W({},"__esModule",{value:!0}),s);var le=h(q=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0});q.redactString=ce;q.sanitizeArgs=Vt;function Le(s){return s.replace(/([A-Za-z0-9._%+-])[^@\s]*(@[A-Za-z0-9.-]+\.[A-Za-z]{2,})/g,(e,r,t)=>`${r}***${t}`)}function ce(s){let e=s;return e=e.replace(/bearer\s+[^\s"']+/gi,"Bearer ***"),e=e.replace(/(password|pass|pwd|secret|token|auth|authorization|key)\s*[:=]\s*[^\s&"']+/gi,"$1=***"),e=e.replace(/((?:code|2fa|two[-\s]?factor|otp)\s*[:=\s]+)(\d{4,8})/gi,(r,t)=>`${t}******`),e=e.replace(/[a-f0-9]{32,}/gi,"***"),e=e.replace(/[A-Za-z0-9+/]{20,}={0,2}/g,"***"),e=Le(e),e}function Be(s,e){let r=s.toLowerCase();if(e==null)return e;if(typeof e=="string")return["password","pass","pwd","secret","token","auth","authorization","applepassword"].includes(r)?"***":["code","otp","2fa","twofactor","two_factor"].includes(r)?"******":["email","appleid","apple_id","username","user"].includes(r)?Le(e):ce(e);if(typeof e=="number")return["code","otp","2fa"].includes(r)?0:e;if(typeof e=="object")try{let t=JSON.stringify(e,(a,n)=>Be(a,n));return JSON.parse(t)}catch{return e}return e}function Vt(s){return s.map(e=>{if(typeof e=="string")return ce(e);if(typeof e=="object"&&e!==null)try{let r=JSON.stringify(e,(t,a)=>Be(t,a));return JSON.parse(r)}catch{return e}return e})}});var je=h(M=>{"use strict";Object.defineProperty(M,"__esModule",{value:!0});M.logger=M.Logger=void 0;var jt=require("@raycast/api"),Ve=le(),z=class s{constructor(e={}){this.config={isVerboseEnabled:e.isVerboseEnabled||this.defaultVerboseCheck,prefix:e.prefix||"",enableRedaction:e.enableRedaction??!0}}defaultVerboseCheck(){try{return(0,jt.getPreferenceValues)().verboseLogging||!1}catch(e){return console.error("[Logger] Failed to read preferences for verbose logging:",e),!1}}static getInstance(){return s.instance||(s.instance=new s),s.instance}formatMessage(e){return this.config.prefix?`${this.config.prefix} ${e}`:e}processLogData(e,r){let t=this.formatMessage(e);return this.config.enableRedaction?[(0,Ve.redactString)(t),(0,Ve.sanitizeArgs)(r)]:[t,r]}log(e,...r){if(this.config.isVerboseEnabled()){let[t,a]=this.processLogData(e,r);console.log(t,...a)}}error(e,...r){let[t,a]=this.processLogData(e,r);console.error(t,...a)}warn(e,...r){let[t,a]=this.processLogData(e,r);console.warn(t,...a)}child(e){let r=this.config.prefix?`${this.config.prefix} ${e}`:e;return new s({...this.config,prefix:r})}};M.Logger=z;M.logger=z.getInstance()});var ue=h(d=>{"use strict";Object.defineProperty(d,"__esModule",{value:!0});d.sanitizeArgs=d.redactString=d.logger=d.Logger=void 0;var We=je();Object.defineProperty(d,"Logger",{enumerable:!0,get:function(){return We.Logger}});Object.defineProperty(d,"logger",{enumerable:!0,get:function(){return We.logger}});var Ke=le();Object.defineProperty(d,"redactString",{enumerable:!0,get:function(){return Ke.redactString}});Object.defineProperty(d,"sanitizeArgs",{enumerable:!0,get:function(){return Ke.sanitizeArgs}})});var te=h((os,Xe)=>{"use strict";var{Readable:ns,Writable:is,Duplex:qt,Transform:Ye}=require("stream"),zt=Symbol.for("object-stream.none"),me=Symbol.for("object-stream.final"),de=Symbol.for("object-stream.many"),Ht=s=>({[me]:s}),Jt=s=>({[de]:s}),Gt=s=>s&&typeof s=="object"&&me in s,Zt=s=>s&&typeof s=="object"&&de in s,Yt=s=>s[me],Xt=s=>s[de],Qt=async(s,e)=>{for(;;){let r=s.next();if(r&&typeof r.then=="function"&&(r=await r),r.done)break;let t=r.value;t&&typeof t.then=="function"&&(t=await t),c.sanitize(t,e)}},er=s=>new Ye({writableObjectMode:!0,readableObjectMode:!0,transform(e,r,t){try{let a=s.call(this,e,r);if(a&&typeof a.then=="function"){a.then(n=>(c.sanitize(n,this),t(null)),n=>t(n));return}if(a&&typeof a.next=="function"){Qt(a,this).then(()=>t(null),n=>t(n));return}c.sanitize(a,this),t(null)}catch(a){t(a)}}}),tr=s=>new Ye({writableObjectMode:!0,readableObjectMode:!0,transform(e,r,t){try{let a=e;for(let n=0;n<s.length;++n){let l=s[n].call(this,a,r);if(l===c.none){t(null);return}if(c.isFinal(l)){a=c.getFinalValue(l);break}a=l}c.sanitize(a,this),t(null)}catch(a){t(a)}}}),Ge=s=>s&&typeof s.pipe=="function"&&typeof s.on=="function"&&(!s._writableState||(typeof s._readableState=="object"?s._readableState.readable:null)!==!1)&&(!s._writableState||s._readableState),Ze=s=>s&&typeof s.write=="function"&&typeof s.on=="function"&&(!s._readableState||(typeof s._writableState=="object"?s._writableState.writable:null)!==!1),rr=s=>s&&typeof s.pipe=="function"&&s._readableState&&typeof s.on=="function"&&typeof s.write=="function",c=class s extends qt{constructor(e,r){if(super(r||{writableObjectMode:!0,readableObjectMode:!0}),!(e instanceof Array)||!e.length)throw Error("Chain's argument should be a non-empty array.");this.streams=e.filter(t=>t).map((t,a,n)=>{if(typeof t=="function"||t instanceof Array)return s.convertToTransform(t);if(rr(t)||!a&&Ge(t)||a===n.length-1&&Ze(t))return t;throw Error("Arguments should be functions, arrays or streams.")}).filter(t=>t),this.input=this.streams[0],this.output=this.streams.reduce((t,a)=>t&&t.pipe(a)||a),Ze(this.input)||(this._write=(t,a,n)=>n(null),this._final=t=>t(null),this.input.on("end",()=>this.end())),Ge(this.output)?(this.output.on("data",t=>!this.push(t)&&this.output.pause()),this.output.on("end",()=>this.push(null))):(this._read=()=>{},this.resume(),this.output.on("finish",()=>this.push(null))),(!r||!r.skipEvents)&&this.streams.forEach(t=>t.on("error",a=>this.emit("error",a)))}_write(e,r,t){let a=null;try{this.input.write(e,r,n=>t(n||a))}catch(n){a=n}}_final(e){let r=null;try{this.input.end(null,null,t=>e(t||r))}catch(t){r=t}}_read(){this.output.resume()}static make(e,r){return new s(e,r)}static sanitize(e,r){s.isFinal(e)?e=s.getFinalValue(e):s.isMany(e)&&(e=s.getManyValues(e)),e!=null&&e!==s.none&&(e instanceof Array?e.forEach(t=>t!=null&&r.push(t)):r.push(e))}static convertToTransform(e){return typeof e=="function"?er(e):e instanceof Array&&e.length?tr(e):null}};c.none=zt;c.final=Ht;c.isFinal=Gt;c.getFinalValue=Yt;c.many=Jt;c.isMany=Zt;c.getManyValues=Xt;c.chain=c.make;c.make.Constructor=c;Xe.exports=c});var et=h((cs,Qe)=>{"use strict";var{Transform:sr}=require("stream"),{StringDecoder:ar}=require("string_decoder"),ge=class extends sr{constructor(e){super(Object.assign({},e,{writableObjectMode:!1})),this._buffer=""}_transform(e,r,t){typeof e=="string"?this._transform=this._transformString:(this._stringDecoder=new ar,this._transform=this._transformBuffer),this._transform(e,r,t)}_transformBuffer(e,r,t){this._buffer+=this._stringDecoder.write(e),this._processBuffer(t)}_transformString(e,r,t){this._buffer+=e.toString(),this._processBuffer(t)}_processBuffer(e){this._buffer&&(this.push(this._buffer,"utf8"),this._buffer=""),e(null)}_flushInput(){this._stringDecoder&&(this._buffer+=this._stringDecoder.end())}_flush(e){this._flushInput(),this._processBuffer(e)}};Qe.exports=ge});var be=h((ls,tt)=>{"use strict";var nr=et(),i={value1:/^(?:[\"\{\[\]\-\d]|true\b|false\b|null\b|\s{1,256})/,string:/^(?:[^\x00-\x1f\"\\]{1,256}|\\[bfnrt\"\\\/]|\\u[\da-fA-F]{4}|\")/,key1:/^(?:[\"\}]|\s{1,256})/,colon:/^(?:\:|\s{1,256})/,comma:/^(?:[\,\]\}]|\s{1,256})/,ws:/^\s{1,256}/,numberStart:/^\d/,numberDigit:/^\d{0,256}/,numberFraction:/^[\.eE]/,numberExponent:/^[eE]/,numberExpSign:/^[-+]/},ir=16,u=!0;try{new RegExp(".","y"),u=!1}catch{}!u&&Object.keys(i).forEach(s=>{let e=i[s].source.slice(1);e.slice(0,3)==="(?:"&&e.slice(-1)===")"&&(e=e.slice(3,-1)),i[s]=new RegExp(e,"y")});i.numberFracStart=i.numberExpStart=i.numberStart;i.numberFracDigit=i.numberExpDigit=i.numberDigit;var or={true:!0,false:!1,null:null},g={object:"objectStop",array:"arrayStop","":"done"},cr=s=>String.fromCharCode(parseInt(s.slice(2),16)),lr={b:"\b",f:"\f",n:`
`,r:"\r",t:"	",'"':'"',"\\":"\\","/":"/"},C=class s extends nr{static make(e){return new s(e)}constructor(e){super(Object.assign({},e,{readableObjectMode:!0})),this._packKeys=this._packStrings=this._packNumbers=this._streamKeys=this._streamStrings=this._streamNumbers=!0,e&&("packValues"in e&&(this._packKeys=this._packStrings=this._packNumbers=e.packValues),"packKeys"in e&&(this._packKeys=e.packKeys),"packStrings"in e&&(this._packStrings=e.packStrings),"packNumbers"in e&&(this._packNumbers=e.packNumbers),"streamValues"in e&&(this._streamKeys=this._streamStrings=this._streamNumbers=e.streamValues),"streamKeys"in e&&(this._streamKeys=e.streamKeys),"streamStrings"in e&&(this._streamStrings=e.streamStrings),"streamNumbers"in e&&(this._streamNumbers=e.streamNumbers),this._jsonStreaming=e.jsonStreaming),!this._packKeys&&(this._streamKeys=!0),!this._packStrings&&(this._streamStrings=!0),!this._packNumbers&&(this._streamNumbers=!0),this._done=!1,this._expect=this._jsonStreaming?"done":"value",this._stack=[],this._parent="",this._open_number=!1,this._accumulator=""}_flush(e){this._done=!0,super._flush(r=>{if(r)return e(r);this._open_number&&(this._streamNumbers&&this.push({name:"endNumber"}),this._open_number=!1,this._packNumbers&&(this.push({name:"numberValue",value:this._accumulator}),this._accumulator="")),e(null)})}_processBuffer(e){let r,t,a=0;e:for(;;)switch(this._expect){case"value1":case"value":if(i.value1.lastIndex=a,r=i.value1.exec(this._buffer),!r){if(this._done||a+ir<this._buffer.length)return a<this._buffer.length?e(new Error("Parser cannot parse input: expected a value")):e(new Error("Parser has expected a value"));break e}switch(t=r[0],t){case'"':this._streamStrings&&this.push({name:"startString"}),this._expect="string";break;case"{":this.push({name:"startObject"}),this._stack.push(this._parent),this._parent="object",this._expect="key1";break;case"[":this.push({name:"startArray"}),this._stack.push(this._parent),this._parent="array",this._expect="value1";break;case"]":if(this._expect!=="value1")return e(new Error("Parser cannot parse input: unexpected token ']'"));this._open_number&&(this._streamNumbers&&this.push({name:"endNumber"}),this._open_number=!1,this._packNumbers&&(this.push({name:"numberValue",value:this._accumulator}),this._accumulator="")),this.push({name:"endArray"}),this._parent=this._stack.pop(),this._expect=g[this._parent];break;case"-":this._open_number=!0,this._streamNumbers&&(this.push({name:"startNumber"}),this.push({name:"numberChunk",value:"-"})),this._packNumbers&&(this._accumulator="-"),this._expect="numberStart";break;case"0":this._open_number=!0,this._streamNumbers&&(this.push({name:"startNumber"}),this.push({name:"numberChunk",value:"0"})),this._packNumbers&&(this._accumulator="0"),this._expect="numberFraction";break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":this._open_number=!0,this._streamNumbers&&(this.push({name:"startNumber"}),this.push({name:"numberChunk",value:t})),this._packNumbers&&(this._accumulator=t),this._expect="numberDigit";break;case"true":case"false":case"null":if(this._buffer.length-a===t.length&&!this._done)break e;this.push({name:t+"Value",value:or[t]}),this._expect=g[this._parent];break}u?this._buffer=this._buffer.slice(t.length):a+=t.length;break;case"keyVal":case"string":if(i.string.lastIndex=a,r=i.string.exec(this._buffer),!r){if(a<this._buffer.length&&(this._done||this._buffer.length-a>=6))return e(new Error("Parser cannot parse input: escaped characters"));if(this._done)return e(new Error("Parser has expected a string value"));break e}if(t=r[0],t==='"')this._expect==="keyVal"?(this._streamKeys&&this.push({name:"endKey"}),this._packKeys&&(this.push({name:"keyValue",value:this._accumulator}),this._accumulator=""),this._expect="colon"):(this._streamStrings&&this.push({name:"endString"}),this._packStrings&&(this.push({name:"stringValue",value:this._accumulator}),this._accumulator=""),this._expect=g[this._parent]);else if(t.length>1&&t.charAt(0)==="\\"){let n=t.length==2?lr[t.charAt(1)]:cr(t);(this._expect==="keyVal"?this._streamKeys:this._streamStrings)&&this.push({name:"stringChunk",value:n}),(this._expect==="keyVal"?this._packKeys:this._packStrings)&&(this._accumulator+=n)}else(this._expect==="keyVal"?this._streamKeys:this._streamStrings)&&this.push({name:"stringChunk",value:t}),(this._expect==="keyVal"?this._packKeys:this._packStrings)&&(this._accumulator+=t);u?this._buffer=this._buffer.slice(t.length):a+=t.length;break;case"key1":case"key":if(i.key1.lastIndex=a,r=i.key1.exec(this._buffer),!r){if(a<this._buffer.length||this._done)return e(new Error("Parser cannot parse input: expected an object key"));break e}if(t=r[0],t==='"')this._streamKeys&&this.push({name:"startKey"}),this._expect="keyVal";else if(t==="}"){if(this._expect!=="key1")return e(new Error("Parser cannot parse input: unexpected token '}'"));this.push({name:"endObject"}),this._parent=this._stack.pop(),this._expect=g[this._parent]}u?this._buffer=this._buffer.slice(t.length):a+=t.length;break;case"colon":if(i.colon.lastIndex=a,r=i.colon.exec(this._buffer),!r){if(a<this._buffer.length||this._done)return e(new Error("Parser cannot parse input: expected ':'"));break e}t=r[0],t===":"&&(this._expect="value"),u?this._buffer=this._buffer.slice(t.length):a+=t.length;break;case"arrayStop":case"objectStop":if(i.comma.lastIndex=a,r=i.comma.exec(this._buffer),!r){if(a<this._buffer.length||this._done)return e(new Error("Parser cannot parse input: expected ','"));break e}if(this._open_number&&(this._streamNumbers&&this.push({name:"endNumber"}),this._open_number=!1,this._packNumbers&&(this.push({name:"numberValue",value:this._accumulator}),this._accumulator="")),t=r[0],t===",")this._expect=this._expect==="arrayStop"?"value":"key";else if(t==="}"||t==="]"){if(t==="}"?this._expect==="arrayStop":this._expect!=="arrayStop")return e(new Error("Parser cannot parse input: expected '"+(this._expect==="arrayStop"?"]":"}")+"'"));this.push({name:t==="}"?"endObject":"endArray"}),this._parent=this._stack.pop(),this._expect=g[this._parent]}u?this._buffer=this._buffer.slice(t.length):a+=t.length;break;case"numberStart":if(i.numberStart.lastIndex=a,r=i.numberStart.exec(this._buffer),!r){if(a<this._buffer.length||this._done)return e(new Error("Parser cannot parse input: expected a starting digit"));break e}t=r[0],this._streamNumbers&&this.push({name:"numberChunk",value:t}),this._packNumbers&&(this._accumulator+=t),this._expect=t==="0"?"numberFraction":"numberDigit",u?this._buffer=this._buffer.slice(t.length):a+=t.length;break;case"numberDigit":if(i.numberDigit.lastIndex=a,r=i.numberDigit.exec(this._buffer),!r){if(a<this._buffer.length||this._done)return e(new Error("Parser cannot parse input: expected a digit"));break e}if(t=r[0],t)this._streamNumbers&&this.push({name:"numberChunk",value:t}),this._packNumbers&&(this._accumulator+=t),u?this._buffer=this._buffer.slice(t.length):a+=t.length;else{if(a<this._buffer.length){this._expect="numberFraction";break}if(this._done){this._expect=g[this._parent];break}break e}break;case"numberFraction":if(i.numberFraction.lastIndex=a,r=i.numberFraction.exec(this._buffer),!r){if(a<this._buffer.length||this._done){this._expect=g[this._parent];break}break e}t=r[0],this._streamNumbers&&this.push({name:"numberChunk",value:t}),this._packNumbers&&(this._accumulator+=t),this._expect=t==="."?"numberFracStart":"numberExpSign",u?this._buffer=this._buffer.slice(t.length):a+=t.length;break;case"numberFracStart":if(i.numberFracStart.lastIndex=a,r=i.numberFracStart.exec(this._buffer),!r){if(a<this._buffer.length||this._done)return e(new Error("Parser cannot parse input: expected a fractional part of a number"));break e}t=r[0],this._streamNumbers&&this.push({name:"numberChunk",value:t}),this._packNumbers&&(this._accumulator+=t),this._expect="numberFracDigit",u?this._buffer=this._buffer.slice(t.length):a+=t.length;break;case"numberFracDigit":if(i.numberFracDigit.lastIndex=a,r=i.numberFracDigit.exec(this._buffer),t=r[0],t)this._streamNumbers&&this.push({name:"numberChunk",value:t}),this._packNumbers&&(this._accumulator+=t),u?this._buffer=this._buffer.slice(t.length):a+=t.length;else{if(a<this._buffer.length){this._expect="numberExponent";break}if(this._done){this._expect=g[this._parent];break}break e}break;case"numberExponent":if(i.numberExponent.lastIndex=a,r=i.numberExponent.exec(this._buffer),!r){if(a<this._buffer.length){this._expect=g[this._parent];break}if(this._done){this._expect="done";break}break e}t=r[0],this._streamNumbers&&this.push({name:"numberChunk",value:t}),this._packNumbers&&(this._accumulator+=t),this._expect="numberExpSign",u?this._buffer=this._buffer.slice(t.length):a+=t.length;break;case"numberExpSign":if(i.numberExpSign.lastIndex=a,r=i.numberExpSign.exec(this._buffer),!r){if(a<this._buffer.length){this._expect="numberExpStart";break}if(this._done)return e(new Error("Parser has expected an exponent value of a number"));break e}t=r[0],this._streamNumbers&&this.push({name:"numberChunk",value:t}),this._packNumbers&&(this._accumulator+=t),this._expect="numberExpStart",u?this._buffer=this._buffer.slice(t.length):a+=t.length;break;case"numberExpStart":if(i.numberExpStart.lastIndex=a,r=i.numberExpStart.exec(this._buffer),!r){if(a<this._buffer.length||this._done)return e(new Error("Parser cannot parse input: expected an exponent part of a number"));break e}t=r[0],this._streamNumbers&&this.push({name:"numberChunk",value:t}),this._packNumbers&&(this._accumulator+=t),this._expect="numberExpDigit",u?this._buffer=this._buffer.slice(t.length):a+=t.length;break;case"numberExpDigit":if(i.numberExpDigit.lastIndex=a,r=i.numberExpDigit.exec(this._buffer),t=r[0],t)this._streamNumbers&&this.push({name:"numberChunk",value:t}),this._packNumbers&&(this._accumulator+=t),u?this._buffer=this._buffer.slice(t.length):a+=t.length;else{if(a<this._buffer.length||this._done){this._expect=g[this._parent];break}break e}break;case"done":if(i.ws.lastIndex=a,r=i.ws.exec(this._buffer),!r){if(a<this._buffer.length){if(this._jsonStreaming){this._expect="value";break}return e(new Error("Parser cannot parse input: unexpected characters"))}break e}t=r[0],this._open_number&&(this._streamNumbers&&this.push({name:"endNumber"}),this._open_number=!1,this._packNumbers&&(this.push({name:"numberValue",value:this._accumulator}),this._accumulator="")),u?this._buffer=this._buffer.slice(t.length):a+=t.length;break}!u&&(this._buffer=this._buffer.slice(a)),e(null)}};C.parser=C.make;C.make.Constructor=C;tt.exports=C});var st=h((us,rt)=>{"use strict";var ur=s=>s.on("data",e=>s.emit(e.name,e.value));rt.exports=ur});var ke=h((hs,at)=>{"use strict";var _e=be(),hr=st(),we=s=>hr(new _e(s));we.Parser=_e;we.parser=_e.parser;at.exports=we});var Se=h((fs,nt)=>{"use strict";var{Transform:fr}=require("stream"),b=class s extends fr{static stringFilter(e,r){return t=>{let a=t.join(r);return a.length===e.length&&a===e||a.length>e.length&&a.substr(0,e.length)===e&&a.substr(e.length,r.length)===r}}static regExpFilter(e,r){return t=>e.test(t.join(r))}static arrayReplacement(e){return()=>e}constructor(e){super(Object.assign({},e,{writableObjectMode:!0,readableObjectMode:!0})),this._transform=this._check,this._stack=[];let r=e&&e.filter,t=e&&e.pathSeparator||".";typeof r=="string"?this._filter=s.stringFilter(r,t):typeof r=="function"?this._filter=r:r instanceof RegExp&&(this._filter=s.regExpFilter(r,t));let a=e&&e.replacement;typeof a=="function"?this._replacement=a:this._replacement=s.arrayReplacement(a||s.defaultReplacement),this._allowEmptyReplacement=e&&e.allowEmptyReplacement,this._streamKeys=!0,e&&("streamValues"in e&&(this._streamKeys=e.streamValues),"streamKeys"in e&&(this._streamKeys=e.streamKeys)),this._once=e&&e.once,this._previousToken=""}_check(e,r,t){switch(e.name){case"startObject":case"startArray":case"startString":case"startNumber":case"nullValue":case"trueValue":case"falseValue":typeof this._stack[this._stack.length-1]=="number"&&++this._stack[this._stack.length-1];break;case"keyValue":this._stack[this._stack.length-1]=e.value;break;case"numberValue":this._previousToken!=="endNumber"&&typeof this._stack[this._stack.length-1]=="number"&&++this._stack[this._stack.length-1];break;case"stringValue":this._previousToken!=="endString"&&typeof this._stack[this._stack.length-1]=="number"&&++this._stack[this._stack.length-1];break}if(this._previousToken=e.name,this._checkChunk(e))return t(null);switch(e.name){case"startObject":this._stack.push(null);break;case"startArray":this._stack.push(-1);break;case"endObject":case"endArray":this._stack.pop();break}t(null)}_passObject(e,r,t){switch(this.push(e),e.name){case"startObject":case"startArray":++this._depth;break;case"endObject":case"endArray":--this._depth;break}this._depth||(this._transform=this._once?this._skip:this._check),t(null)}_pass(e,r,t){this.push(e),t(null)}_skipObject(e,r,t){switch(e.name){case"startObject":case"startArray":++this._depth;break;case"endObject":case"endArray":--this._depth;break}this._depth||(this._transform=this._once?this._pass:this._check),t(null)}_skip(e,r,t){t(null)}};b.defaultReplacement=[{name:"nullValue",value:null}];var ye=(s,e)=>function(r,t,a){if(this._expected){let n=this._expected;if(this._expected="",this._transform=this._once?this._skip:this._check,n===r.name)this.push(r);else return this._transform(r,t,a)}else this.push(r),r.name===s&&(this._expected=e);a(null)};b.prototype._passNumber=ye("endNumber","numberValue");b.prototype._passString=ye("endString","stringValue");b.prototype._passKey=ye("endKey","keyValue");var xe=(s,e)=>function(r,t,a){if(this._expected){let n=this._expected;if(this._expected="",this._transform=this._once?this._pass:this._check,n!==r.name)return this._transform(r,t,a)}else r.name===s&&(this._expected=e);a(null)};b.prototype._skipNumber=xe("endNumber","numberValue");b.prototype._skipString=xe("endString","stringValue");b.prototype._skipKey=xe("endKey","keyValue");nt.exports=b});var V=h((ps,it)=>{"use strict";var{chain:pr}=te(),mr=be(),dr=(s,e)=>pr([new mr(e),s(e)],Object.assign({},e,{writableObjectMode:!1,readableObjectMode:!0}));it.exports=dr});var ct=h((ms,ot)=>{"use strict";var gr=Se(),br=V(),P=class s extends gr{static make(e){return new s(e)}static withParser(e){return br(s.make,e)}constructor(e){super(e),this._once=!1,this._lastStack=[]}_flush(e){this._syncStack(),e(null)}_checkChunk(e){switch(e.name){case"startObject":this._filter(this._stack,e)&&(this._syncStack(),this.push(e),this._lastStack.push(null));break;case"startArray":this._filter(this._stack,e)&&(this._syncStack(),this.push(e),this._lastStack.push(-1));break;case"nullValue":case"trueValue":case"falseValue":case"stringValue":case"numberValue":this._filter(this._stack,e)&&(this._syncStack(),this.push(e));break;case"startString":this._filter(this._stack,e)?(this._syncStack(),this.push(e),this._transform=this._passString):this._transform=this._skipString;break;case"startNumber":this._filter(this._stack,e)?(this._syncStack(),this.push(e),this._transform=this._passNumber):this._transform=this._skipNumber;break}return!1}_syncStack(){let e=this._stack,r=this._lastStack,t=e.length,a=r.length,n=0;for(let l=Math.min(t,a);n<l&&e[n]===r[n];++n);for(let l=a-1;l>n;--l)this.push({name:typeof r[l]=="number"?"endArray":"endObject"});if(n<a)if(n<t){if(typeof e[n]=="string"){let l=e[n];this._streamKeys&&(this.push({name:"startKey"}),this.push({name:"stringChunk",value:l}),this.push({name:"endKey"})),this.push({name:"keyValue",value:l})}++n}else this.push({name:typeof r[n]=="number"?"endArray":"endObject"});for(let l=n;l<t;++l){let k=e[l];typeof k=="number"?k>=0&&this.push({name:"startArray"}):typeof k=="string"&&(this.push({name:"startObject"}),this._streamKeys&&(this.push({name:"startKey"}),this.push({name:"stringChunk",value:k}),this.push({name:"endKey"})),this.push({name:"keyValue",value:k}))}this._lastStack=Array.prototype.concat.call(e)}};P.filter=P.make;P.make.Constructor=P;ot.exports=P});var ht=h((ds,ut)=>{"use strict";var _r=require("events"),lt=s=>function(){this.done?this.done=!1:this.stack.push(this.current,this.key),this.current=new s,this.key=null},w=class s extends _r{static connectTo(e,r){return new s(r).connectTo(e)}constructor(e){super(),this.stack=[],this.current=this.key=null,this.done=!0,e&&(this.reviver=typeof e.reviver=="function"&&e.reviver,this.reviver&&(this.stringValue=this._saveValue=this._saveValueWithReviver),e.numberAsString&&(this.numberValue=this.stringValue))}connectTo(e){return e.on("data",r=>{this[r.name]&&(this[r.name](r.value),this.done&&this.emit("done",this))}),this}get depth(){return(this.stack.length>>1)+(this.done?0:1)}get path(){let e=[];for(let r=0;r<this.stack.length;r+=2){let t=this.stack[r+1];e.push(t===null?this.stack[r].length:t)}return e}dropToLevel(e){if(e<this.depth)if(e){let r=e-1<<1;this.current=this.stack[r],this.key=this.stack[r+1],this.stack.splice(r)}else this.stack=[],this.current=this.key=null,this.done=!0;return this}consume(e){return this[e.name]&&this[e.name](e.value),this}keyValue(e){this.key=e}numberValue(e){this._saveValue(parseFloat(e))}nullValue(){this._saveValue(null)}trueValue(){this._saveValue(!0)}falseValue(){this._saveValue(!1)}endObject(){if(this.stack.length){let e=this.current;this.key=this.stack.pop(),this.current=this.stack.pop(),this._saveValue(e)}else this.done=!0}_saveValue(e){this.done?this.current=e:this.current instanceof Array?this.current.push(e):(this.current[this.key]=e,this.key=null)}_saveValueWithReviver(e){this.done?this.current=this.reviver("",e):this.current instanceof Array?(e=this.reviver(""+this.current.length,e),this.current.push(e),e===void 0&&delete this.current[this.current.length-1]):(e=this.reviver(this.key,e),e!==void 0&&(this.current[this.key]=e),this.key=null)}};w.prototype.stringValue=w.prototype._saveValue;w.prototype.startObject=lt(Object);w.prototype.startArray=lt(Array);w.prototype.endArray=w.prototype.endObject;ut.exports=w});var Ee=h((gs,ft)=>{"use strict";var{Transform:wr}=require("stream"),kr=ht(),Ce=class{constructor(e){this.depth=e}startObject(){++this.depth}endObject(){--this.depth}startArray(){++this.depth}endArray(){--this.depth}},Pe=class extends wr{constructor(e){super(Object.assign({},e,{writableObjectMode:!0,readableObjectMode:!0})),e&&(this.objectFilter=e.objectFilter,this.includeUndecided=e.includeUndecided),typeof this.objectFilter!="function"&&(this._filter=this._transform),this._transform=this._wait||this._filter,this._assembler=new kr(e)}_transform(e,r,t){this._assembler[e.name]&&(this._assembler[e.name](e.value),this._assembler.depth===this._level&&this._push()),t(null)}_filter(e,r,t){if(this._assembler[e.name]){this._assembler[e.name](e.value);let a=this.objectFilter(this._assembler);if(a)return this._assembler.depth===this._level&&(this._push(),this._transform=this._filter),this._transform=this._accept,t(null);if(a===!1)return this._saved_assembler=this._assembler,this._assembler=new Ce(this._saved_assembler.depth),this._saved_assembler.dropToLevel(this._level),this._assembler.depth===this._level&&(this._assembler=this._saved_assembler,this._transform=this._filter),this._transform=this._reject,t(null);this._assembler.depth===this._level&&this._push(!this.includeUndecided)}t(null)}_accept(e,r,t){this._assembler[e.name]&&(this._assembler[e.name](e.value),this._assembler.depth===this._level&&(this._push(),this._transform=this._filter)),t(null)}_reject(e,r,t){this._assembler[e.name]&&(this._assembler[e.name](e.value),this._assembler.depth===this._level&&(this._assembler=this._saved_assembler,this._transform=this._filter)),t(null)}};ft.exports=Pe});var mt=h((bs,pt)=>{"use strict";var yr=Ee(),xr=V(),E=class s extends yr{static make(e){return new s(e)}static withParser(e){return xr(s.make,e)}constructor(e){super(e),this._level=1,this._counter=0}_wait(e,r,t){return e.name!=="startArray"?t(new Error("Top-level object should be an array.")):(this._transform=this._filter,this._transform(e,r,t))}_push(e){this._assembler.current.length&&(e?(++this._counter,this._assembler.current.pop()):this.push({key:this._counter++,value:this._assembler.current.pop()}))}};E.streamArray=E.make;E.make.Constructor=E;pt.exports=E});var Et=h((Os,Pt)=>{"use strict";var Ar=Se(),Nr=V(),v=class s extends Ar{static make(e){return new s(e)}static withParser(e){return Nr(s.make,e)}_checkChunk(e){switch(e.name){case"startObject":case"startArray":if(this._filter(this._stack,e))return this.push(e),this._transform=this._passObject,this._depth=1,!0;break;case"startString":if(this._filter(this._stack,e))return this.push(e),this._transform=this._passString,!0;break;case"startNumber":if(this._filter(this._stack,e))return this.push(e),this._transform=this._passNumber,!0;break;case"nullValue":case"trueValue":case"falseValue":case"stringValue":case"numberValue":if(this._filter(this._stack,e))return this.push(e),this._transform=this._once?this._skip:this._check,!0;break}return!1}};v.pick=v.make;v.make.Constructor=v;Pt.exports=v});var Tt=h((Rs,vt)=>{"use strict";var Fr=Ee(),Dr=V(),T=class s extends Fr{static make(e){return new s(e)}static withParser(e){return Dr(s.make,e)}constructor(e){super(e),this._level=1,this._lastKey=null}_wait(e,r,t){return e.name!=="startObject"?t(new Error("Top-level object should be an object.")):(this._transform=this._filter,this._transform(e,r,t))}_push(e){this._lastKey===null?this._lastKey=this._assembler.key:(!e&&this.push({key:this._lastKey,value:this._assembler.current[this._lastKey]}),this._assembler.current={},this._lastKey=null)}};T.streamObject=T.make;T.make.Constructor=T;vt.exports=T});var Jr={};Lt(Jr,{default:()=>Hr});module.exports=Bt(Jr);var ne=require("@raycast/api");var Re=require("child_process"),oe=require("path"),$e=require("os");var Oe=require("@raycast/api"),o=(0,Oe.getPreferenceValues)();var Ue=(()=>{if(o.customBrewPath&&o.customBrewPath.length>0)return(0,oe.join)(o.customBrewPath,"..","..");try{return(0,Re.execSync)("brew --prefix",{encoding:"utf8"}).trim()}catch{return(0,$e.cpus)()[0]?.model?.includes("Apple")?"/opt/homebrew":"/usr/local"}})(),K=s=>(0,oe.join)(Ue,s),I=()=>K("bin/brew");var wt=require("child_process"),kt=require("util"),yt=require("fs"),se=m(require("fs/promises")),xt=require("path"),St=require("@raycast/api");var qe=m(ue()),x=new qe.Logger({prefix:"[Brew]"}),A=x.child("[Commands]"),O=x.child("[Cache]"),R=x.child("[Actions]"),he=x.child("[Fetch]"),ze=x.child("[Search]"),H=x.child("[UI]");var p=class extends Error{constructor(e,r){super(e),this.name="BrewError",this.brewCause=r?.cause}},N=class extends p{constructor(e,r){super(e,{cause:r?.cause}),this.name="NetworkError",this.statusCode=r?.statusCode,this.url=r?.url}};var $=class extends p{constructor(e,r){super(e,{cause:r?.cause}),this.name="BrewCommandError",this.command=r?.command,this.exitCode=r?.exitCode,this.stderr=r?.stderr}},J=class extends p{constructor(e,r){super(e,{cause:r?.cause}),this.name="BrewNotFoundError",this.path=r?.path}};var _=class extends p{constructor(e,r){super(e,{cause:r?.cause}),this.name="BrewLockError",this.command=r?.command}},U=class extends p{constructor(e,r){super(e,{cause:r?.cause}),this.name="DownloadTimeoutError",this.packageName=r?.packageName,this.phase=r?.phase,this.timeoutMs=r?.timeoutMs,this.elapsedMs=r?.elapsedMs}},S=class extends p{constructor(e,r){super(e,{cause:r?.cause}),this.name="StaleProcessError",this.packageName=r?.packageName,this.lastPhase=r?.lastPhase,this.staleDurationMs=r?.staleDurationMs}},G=class extends p{constructor(e,r){super(e,{cause:r?.cause}),this.name="PackageNotFoundError",this.packageName=r?.packageName,this.packageType=r?.packageType}},Z=class extends p{constructor(e,r){super(e,{cause:r?.cause}),this.name="PackageDisabledError",this.packageName=r?.packageName,this.packageType=r?.packageType,this.disabledDate=r?.disabledDate,this.reason=r?.reason}},Y=class extends p{constructor(e,r){super(e,{cause:r?.cause}),this.name="PackageConflictError",this.packageName=r?.packageName,this.conflictsWith=r?.conflictsWith}},X=class extends p{constructor(e,r){super(e,{cause:r?.cause}),this.name="UnsupportedMacOSError",this.packageName=r?.packageName,this.requiredVersion=r?.requiredVersion,this.currentVersion=r?.currentVersion}};function pe(s){return s instanceof N}function L(s){return s instanceof _}function He(s){return s instanceof U}function Je(s){return s instanceof S}function F(s){return pe(s)||L(s)||He(s)||Je(s)}var Wt=[/lockf:.*already locked/i,/another active Homebrew/i,/another brew process/i,/another.*brew.*update.*process/i,/Homebrew is already running/i,/Error: Another active Homebrew/i,/Error: Another.*brew.*process/i,/waiting for lock/i,/lock file/i,/has already locked/i,/brew upgrade.*process has already/i],Kt=/Error: (Cask|Formula) '([^']+)' has been disabled(?: because (.+?))?(?:! It was disabled on (\d{4}-\d{2}-\d{2}))?/i;function Q(s){return Wt.some(e=>e.test(s))}function fe(s){let e=s.match(Kt);return e?{packageType:e[1].toLowerCase(),packageName:e[2],reason:e[3]?.trim(),disabledDate:e[4]}:null}function ee(s){return s instanceof Error?s:new Error(String(s))}function B(s){if(s instanceof _)return"Another brew process is already running. Please wait for it to finish and try again.";if(s instanceof U){let e=s.packageName?` for "${s.packageName}"`:"",r=s.phase?` during ${s.phase}`:"";return`Download timed out${e}${r}. Please try again.`}if(s instanceof S){let e=s.packageName?` for "${s.packageName}"`:"",r=s.lastPhase?` (stuck at ${s.lastPhase})`:"";return`Process appears stuck${e}${r}. The operation was cancelled.`}if(s instanceof Z){let e=s.packageType??"package",t=`${e.charAt(0).toUpperCase()+e.slice(1)} "${s.packageName}" has been discontinued`;return s.reason&&(t+=`: ${s.reason}`),s.disabledDate&&(t+=` (disabled on ${s.disabledDate})`),t}if(s instanceof Y){let e=s.conflictsWith?.join(", ")??"another package";return`"${s.packageName}" conflicts with ${e}. Please uninstall the conflicting package first.`}if(s instanceof X){let e=`"${s.packageName}" requires a different macOS version`;return s.requiredVersion&&(e+=` (requires ${s.requiredVersion})`),e}if(s instanceof N)return s.statusCode?`Network error (HTTP ${s.statusCode}): ${s.message}`:`Network error: ${s.message}`;if(s instanceof J)return`Homebrew not found: ${s.message}`;if(s instanceof G){let e=s.packageType??"package";return`${e.charAt(0).toUpperCase()+e.slice(1)} not found: ${s.packageName??s.message}`}if(s instanceof $){if(s.exitCode===void 0||s.exitCode===null)return"Cancelled";if(s.stderr){let e=fe(s.stderr);if(e){let r=`${e.packageType.charAt(0).toUpperCase()+e.packageType.slice(1)} "${e.packageName}" has been discontinued`;return e.reason&&(r+=`: ${e.reason}`),e.disabledDate&&(r+=` (disabled on ${e.disabledDate})`),r}}return s.stderr??s.message}if(s instanceof p)return s.message;if(s instanceof Error){if(s.name==="AbortError")return"Cancelled";let e=s;if(e.stderr){let r=fe(e.stderr);if(r){let t=`${r.packageType.charAt(0).toUpperCase()+r.packageType.slice(1)} "${r.packageName}" has been discontinued`;return r.reason&&(t+=`: ${r.reason}`),r.disabledDate&&(t+=` (disabled on ${r.disabledDate})`),t}return e.stderr}return s.message}return String(s)}var D=require("@raycast/api"),ve=m(require("path")),gt=m(require("fs"));var Cr=m(te()),Pr=m(ke()),Er=m(ct()),vr=m(mt());var dt=require("node:timers");async function re(s){return new Promise(e=>(0,dt.setTimeout)(e,s))}var bt=(()=>{try{gt.default.mkdirSync(D.environment.supportPath,{recursive:!0})}catch{O.warn("Failed to create supportPath")}return D.environment.supportPath})(),Te=D.environment.supportPath.split(ve.default.sep).find(s=>!!s.startsWith("com.raycast"))??"com.raycast.macos";function j(s){return ve.default.join(bt,s)}var Tr=(0,kt.promisify)(wt.exec),_t=!1;async function ae(s,e){try{let r=await Me();return await Tr(`${I()} ${s}`,{signal:e?.signal,env:r,maxBuffer:10*1024*1024})}catch(r){let t=r,a=t?.stderr||t?.stdout||"";throw Q(a)?(A.warn("Brew lock detected - another process is running",{command:s,stderr:t?.stderr}),new _("Another brew process is already running",{command:s,cause:t})):o.customBrewPath&&t&&t.code===127?(t.stderr=`Brew executable not found at: ${o.customBrewPath}`,t):r}}async function Me(){let s=(0,xt.join)(St.environment.assetsPath,"askpass.sh");try{await se.access(s,yt.constants.X_OK)}catch{await se.chmod(s,493)}let e={...process.env};e.SUDO_ASKPASS=s,e.HOMEBREW_BROWSER=Te;let r=o.disableDownloadConcurrency;r&&(e.HOMEBREW_DOWNLOAD_CONCURRENCY="1");let t=o.useInternalApi;return t&&(e.HOMEBREW_USE_INTERNAL_API="1"),_t||(_t=!0,A.log("Homebrew 5.0 Configuration",{downloadConcurrencyEnabled:!r,downloadConcurrencyMode:r?"sequential (1)":"parallel (auto)",internalApiEnabled:t,verboseLogging:o.verboseLogging})),e}var Ct=300*1e3,Mr=600*1e3;var $r=m(te()),Ur=m(ke()),Lr=m(Et()),Br=m(Tt());var Mt=m(ue()),Ir=new Mt.Logger({prefix:"[Brew]"}).child("[Memory]");var Js=j("installedv2.json"),Gs=j("formula.json"),Zs=j("cask.json");async function Ae(s,e){R.log("Running cleanup",{pruneAll:s});let r="cleanup";s&&(r+=" --prune=all"),await ae(r,e?{signal:e}:void 0),R.log("Cleanup completed successfully")}var f=require("@raycast/api");function Ne(s){let e={style:f.Toast.Style.Animated,title:s.title,message:s.message},r;s.cancelable&&(r=new AbortController,e.primaryAction={title:"Cancel",onAction:()=>{r?.abort(),t.hide()}});let t=new f.Toast(e);return t.show(),{abort:r,updateMessage:a=>{t.message=a},updateTitle:a=>{t.title=a},showSuccessHUD:async a=>{o.closeAfterAction?(t.hide(),await(0,f.showHUD)(`\u2705 ${a}`)):(t.style=f.Toast.Style.Success,t.title=a,t.message=void 0,t.primaryAction=void 0)},showFailureHUD:async a=>{o.closeAfterAction?(t.hide(),await(0,f.showHUD)(`\u274C ${a}`)):(t.style=f.Toast.Style.Failure,t.title=a,t.message=void 0,t.primaryAction=void 0)},hide:()=>{t.hide()}}}async function Fe(s,e,r){if(e.name==="AbortError"){H.log("Operation aborted by user");return}let t=e,a=B(e),n=L(e);H.error(s,{errorType:e.name,message:e.message,stderr:t.stderr,code:t.code,recoverable:F(e),isLockError:n});let l=n?"Brew is Busy":s,k={style:f.Toast.Style.Failure,title:l,message:a,primaryAction:{title:"Copy Logs",onAction:()=>{let ie=n?`${l}
${a}

Tip: Check Activity Monitor or run 'ps aux | grep brew' in Terminal to see what's running.`:a;f.Clipboard.copy(ie)}}};if(F(e)&&r?.retryAction){let ie=r.retryAction;k.secondaryAction={title:"Retry",onAction:async y=>{y.style=f.Toast.Style.Animated,y.title="Retrying...",y.message=void 0;try{await ie(),y.style=f.Toast.Style.Success,y.title="Success"}catch(De){y.style=f.Toast.Style.Failure,y.title=L(De)?"Brew is Busy":s,y.message=B(De)}}}}await new f.Toast(k).show()}Array.prototype.first||(Array.prototype.first=function(){return this.at(0)});Array.prototype.last||(Array.prototype.last=function(){return this.at(-1)});Array.prototype.isTruncated||(Array.prototype.isTruncated=function(){return this.totalLength?this.length<this.totalLength:!1});String.ellipsis||(String.ellipsis="\u2026");var Hr=async()=>{try{let s=Ne({title:"Cleaning files & packages from the cache"+String.ellipsis,cancelable:!0});await Ae(o.withoutThreshold,s.abort?.signal),(0,ne.showToast)(ne.Toast.Style.Success,"Cleaning completed")}catch(s){await Fe("Cleaning failed",ee(s)),await re(3e3)}};
