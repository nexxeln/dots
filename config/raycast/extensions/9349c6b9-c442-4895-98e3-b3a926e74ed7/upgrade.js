"use strict";var br=Object.create;var xe=Object.defineProperty;var yr=Object.getOwnPropertyDescriptor;var kr=Object.getOwnPropertyNames;var wr=Object.getPrototypeOf,_r=Object.prototype.hasOwnProperty;var A=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),xr=(r,e)=>{for(var t in e)xe(r,t,{get:e[t],enumerable:!0})},ut=(r,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of kr(e))!_r.call(r,a)&&a!==t&&xe(r,a,{get:()=>e[a],enumerable:!(s=yr(e,a))||s.enumerable});return r};var U=(r,e,t)=>(t=r!=null?br(wr(r)):{},ut(e||!r||!r.__esModule?xe(t,"default",{value:r,enumerable:!0}):t,r)),$r=r=>ut(xe({},"__esModule",{value:!0}),r);var Ve=A($e=>{"use strict";Object.defineProperty($e,"__esModule",{value:!0});$e.redactString=Le;$e.sanitizeArgs=vr;function pt(r){return r.replace(/([A-Za-z0-9._%+-])[^@\s]*(@[A-Za-z0-9.-]+\.[A-Za-z]{2,})/g,(e,t,s)=>`${t}***${s}`)}function Le(r){let e=r;return e=e.replace(/bearer\s+[^\s"']+/gi,"Bearer ***"),e=e.replace(/(password|pass|pwd|secret|token|auth|authorization|key)\s*[:=]\s*[^\s&"']+/gi,"$1=***"),e=e.replace(/((?:code|2fa|two[-\s]?factor|otp)\s*[:=\s]+)(\d{4,8})/gi,(t,s)=>`${s}******`),e=e.replace(/[a-f0-9]{32,}/gi,"***"),e=e.replace(/[A-Za-z0-9+/]{20,}={0,2}/g,"***"),e=pt(e),e}function mt(r,e){let t=r.toLowerCase();if(e==null)return e;if(typeof e=="string")return["password","pass","pwd","secret","token","auth","authorization","applepassword"].includes(t)?"***":["code","otp","2fa","twofactor","two_factor"].includes(t)?"******":["email","appleid","apple_id","username","user"].includes(t)?pt(e):Le(e);if(typeof e=="number")return["code","otp","2fa"].includes(t)?0:e;if(typeof e=="object")try{let s=JSON.stringify(e,(a,n)=>mt(a,n));return JSON.parse(s)}catch{return e}return e}function vr(r){return r.map(e=>{if(typeof e=="string")return Le(e);if(typeof e=="object"&&e!==null)try{let t=JSON.stringify(e,(s,a)=>mt(s,a));return JSON.parse(t)}catch{return e}return e})}});var bt=A(ue=>{"use strict";Object.defineProperty(ue,"__esModule",{value:!0});ue.logger=ue.Logger=void 0;var Er=require("@raycast/api"),gt=Ve(),Se=class r{constructor(e={}){this.config={isVerboseEnabled:e.isVerboseEnabled||this.defaultVerboseCheck,prefix:e.prefix||"",enableRedaction:e.enableRedaction??!0}}defaultVerboseCheck(){try{return(0,Er.getPreferenceValues)().verboseLogging||!1}catch(e){return console.error("[Logger] Failed to read preferences for verbose logging:",e),!1}}static getInstance(){return r.instance||(r.instance=new r),r.instance}formatMessage(e){return this.config.prefix?`${this.config.prefix} ${e}`:e}processLogData(e,t){let s=this.formatMessage(e);return this.config.enableRedaction?[(0,gt.redactString)(s),(0,gt.sanitizeArgs)(t)]:[s,t]}log(e,...t){if(this.config.isVerboseEnabled()){let[s,a]=this.processLogData(e,t);console.log(s,...a)}}error(e,...t){let[s,a]=this.processLogData(e,t);console.error(s,...a)}warn(e,...t){let[s,a]=this.processLogData(e,t);console.warn(s,...a)}child(e){let t=this.config.prefix?`${this.config.prefix} ${e}`:e;return new r({...this.config,prefix:t})}};ue.Logger=Se;ue.logger=Se.getInstance()});var je=A(V=>{"use strict";Object.defineProperty(V,"__esModule",{value:!0});V.sanitizeArgs=V.redactString=V.logger=V.Logger=void 0;var yt=bt();Object.defineProperty(V,"Logger",{enumerable:!0,get:function(){return yt.Logger}});Object.defineProperty(V,"logger",{enumerable:!0,get:function(){return yt.logger}});var kt=Ve();Object.defineProperty(V,"redactString",{enumerable:!0,get:function(){return kt.redactString}});Object.defineProperty(V,"sanitizeArgs",{enumerable:!0,get:function(){return kt.sanitizeArgs}})});var Ie=A((Gs,Ct)=>{"use strict";var{Readable:zs,Writable:Ks,Duplex:Ar,Transform:Et}=require("stream"),Tr=Symbol.for("object-stream.none"),Ke=Symbol.for("object-stream.final"),Ge=Symbol.for("object-stream.many"),Rr=r=>({[Ke]:r}),Ir=r=>({[Ge]:r}),Ur=r=>r&&typeof r=="object"&&Ke in r,Mr=r=>r&&typeof r=="object"&&Ge in r,Or=r=>r[Ke],Dr=r=>r[Ge],Nr=async(r,e)=>{for(;;){let t=r.next();if(t&&typeof t.then=="function"&&(t=await t),t.done)break;let s=t.value;s&&typeof s.then=="function"&&(s=await s),_.sanitize(s,e)}},Fr=r=>new Et({writableObjectMode:!0,readableObjectMode:!0,transform(e,t,s){try{let a=r.call(this,e,t);if(a&&typeof a.then=="function"){a.then(n=>(_.sanitize(n,this),s(null)),n=>s(n));return}if(a&&typeof a.next=="function"){Nr(a,this).then(()=>s(null),n=>s(n));return}_.sanitize(a,this),s(null)}catch(a){s(a)}}}),Lr=r=>new Et({writableObjectMode:!0,readableObjectMode:!0,transform(e,t,s){try{let a=e;for(let n=0;n<r.length;++n){let f=r[n].call(this,a,t);if(f===_.none){s(null);return}if(_.isFinal(f)){a=_.getFinalValue(f);break}a=f}_.sanitize(a,this),s(null)}catch(a){s(a)}}}),St=r=>r&&typeof r.pipe=="function"&&typeof r.on=="function"&&(!r._writableState||(typeof r._readableState=="object"?r._readableState.readable:null)!==!1)&&(!r._writableState||r._readableState),vt=r=>r&&typeof r.write=="function"&&typeof r.on=="function"&&(!r._readableState||(typeof r._writableState=="object"?r._writableState.writable:null)!==!1),Vr=r=>r&&typeof r.pipe=="function"&&r._readableState&&typeof r.on=="function"&&typeof r.write=="function",_=class r extends Ar{constructor(e,t){if(super(t||{writableObjectMode:!0,readableObjectMode:!0}),!(e instanceof Array)||!e.length)throw Error("Chain's argument should be a non-empty array.");this.streams=e.filter(s=>s).map((s,a,n)=>{if(typeof s=="function"||s instanceof Array)return r.convertToTransform(s);if(Vr(s)||!a&&St(s)||a===n.length-1&&vt(s))return s;throw Error("Arguments should be functions, arrays or streams.")}).filter(s=>s),this.input=this.streams[0],this.output=this.streams.reduce((s,a)=>s&&s.pipe(a)||a),vt(this.input)||(this._write=(s,a,n)=>n(null),this._final=s=>s(null),this.input.on("end",()=>this.end())),St(this.output)?(this.output.on("data",s=>!this.push(s)&&this.output.pause()),this.output.on("end",()=>this.push(null))):(this._read=()=>{},this.resume(),this.output.on("finish",()=>this.push(null))),(!t||!t.skipEvents)&&this.streams.forEach(s=>s.on("error",a=>this.emit("error",a)))}_write(e,t,s){let a=null;try{this.input.write(e,t,n=>s(n||a))}catch(n){a=n}}_final(e){let t=null;try{this.input.end(null,null,s=>e(s||t))}catch(s){t=s}}_read(){this.output.resume()}static make(e,t){return new r(e,t)}static sanitize(e,t){r.isFinal(e)?e=r.getFinalValue(e):r.isMany(e)&&(e=r.getManyValues(e)),e!=null&&e!==r.none&&(e instanceof Array?e.forEach(s=>s!=null&&t.push(s)):t.push(e))}static convertToTransform(e){return typeof e=="function"?Fr(e):e instanceof Array&&e.length?Lr(e):null}};_.none=Tr;_.final=Rr;_.isFinal=Ur;_.getFinalValue=Or;_.many=Ir;_.isMany=Mr;_.getManyValues=Dr;_.chain=_.make;_.make.Constructor=_;Ct.exports=_});var At=A((Hs,Pt)=>{"use strict";var{Transform:jr}=require("stream"),{StringDecoder:Br}=require("string_decoder"),He=class extends jr{constructor(e){super(Object.assign({},e,{writableObjectMode:!1})),this._buffer=""}_transform(e,t,s){typeof e=="string"?this._transform=this._transformString:(this._stringDecoder=new Br,this._transform=this._transformBuffer),this._transform(e,t,s)}_transformBuffer(e,t,s){this._buffer+=this._stringDecoder.write(e),this._processBuffer(s)}_transformString(e,t,s){this._buffer+=e.toString(),this._processBuffer(s)}_processBuffer(e){this._buffer&&(this.push(this._buffer,"utf8"),this._buffer=""),e(null)}_flushInput(){this._stringDecoder&&(this._buffer+=this._stringDecoder.end())}_flush(e){this._flushInput(),this._processBuffer(e)}};Pt.exports=He});var qe=A((qs,Tt)=>{"use strict";var Wr=At(),u={value1:/^(?:[\"\{\[\]\-\d]|true\b|false\b|null\b|\s{1,256})/,string:/^(?:[^\x00-\x1f\"\\]{1,256}|\\[bfnrt\"\\\/]|\\u[\da-fA-F]{4}|\")/,key1:/^(?:[\"\}]|\s{1,256})/,colon:/^(?:\:|\s{1,256})/,comma:/^(?:[\,\]\}]|\s{1,256})/,ws:/^\s{1,256}/,numberStart:/^\d/,numberDigit:/^\d{0,256}/,numberFraction:/^[\.eE]/,numberExponent:/^[eE]/,numberExpSign:/^[-+]/},zr=16,E=!0;try{new RegExp(".","y"),E=!1}catch{}!E&&Object.keys(u).forEach(r=>{let e=u[r].source.slice(1);e.slice(0,3)==="(?:"&&e.slice(-1)===")"&&(e=e.slice(3,-1)),u[r]=new RegExp(e,"y")});u.numberFracStart=u.numberExpStart=u.numberStart;u.numberFracDigit=u.numberExpDigit=u.numberDigit;var Kr={true:!0,false:!1,null:null},B={object:"objectStop",array:"arrayStop","":"done"},Gr=r=>String.fromCharCode(parseInt(r.slice(2),16)),Hr={b:"\b",f:"\f",n:`
`,r:"\r",t:"	",'"':'"',"\\":"\\","/":"/"},ae=class r extends Wr{static make(e){return new r(e)}constructor(e){super(Object.assign({},e,{readableObjectMode:!0})),this._packKeys=this._packStrings=this._packNumbers=this._streamKeys=this._streamStrings=this._streamNumbers=!0,e&&("packValues"in e&&(this._packKeys=this._packStrings=this._packNumbers=e.packValues),"packKeys"in e&&(this._packKeys=e.packKeys),"packStrings"in e&&(this._packStrings=e.packStrings),"packNumbers"in e&&(this._packNumbers=e.packNumbers),"streamValues"in e&&(this._streamKeys=this._streamStrings=this._streamNumbers=e.streamValues),"streamKeys"in e&&(this._streamKeys=e.streamKeys),"streamStrings"in e&&(this._streamStrings=e.streamStrings),"streamNumbers"in e&&(this._streamNumbers=e.streamNumbers),this._jsonStreaming=e.jsonStreaming),!this._packKeys&&(this._streamKeys=!0),!this._packStrings&&(this._streamStrings=!0),!this._packNumbers&&(this._streamNumbers=!0),this._done=!1,this._expect=this._jsonStreaming?"done":"value",this._stack=[],this._parent="",this._open_number=!1,this._accumulator=""}_flush(e){this._done=!0,super._flush(t=>{if(t)return e(t);this._open_number&&(this._streamNumbers&&this.push({name:"endNumber"}),this._open_number=!1,this._packNumbers&&(this.push({name:"numberValue",value:this._accumulator}),this._accumulator="")),e(null)})}_processBuffer(e){let t,s,a=0;e:for(;;)switch(this._expect){case"value1":case"value":if(u.value1.lastIndex=a,t=u.value1.exec(this._buffer),!t){if(this._done||a+zr<this._buffer.length)return a<this._buffer.length?e(new Error("Parser cannot parse input: expected a value")):e(new Error("Parser has expected a value"));break e}switch(s=t[0],s){case'"':this._streamStrings&&this.push({name:"startString"}),this._expect="string";break;case"{":this.push({name:"startObject"}),this._stack.push(this._parent),this._parent="object",this._expect="key1";break;case"[":this.push({name:"startArray"}),this._stack.push(this._parent),this._parent="array",this._expect="value1";break;case"]":if(this._expect!=="value1")return e(new Error("Parser cannot parse input: unexpected token ']'"));this._open_number&&(this._streamNumbers&&this.push({name:"endNumber"}),this._open_number=!1,this._packNumbers&&(this.push({name:"numberValue",value:this._accumulator}),this._accumulator="")),this.push({name:"endArray"}),this._parent=this._stack.pop(),this._expect=B[this._parent];break;case"-":this._open_number=!0,this._streamNumbers&&(this.push({name:"startNumber"}),this.push({name:"numberChunk",value:"-"})),this._packNumbers&&(this._accumulator="-"),this._expect="numberStart";break;case"0":this._open_number=!0,this._streamNumbers&&(this.push({name:"startNumber"}),this.push({name:"numberChunk",value:"0"})),this._packNumbers&&(this._accumulator="0"),this._expect="numberFraction";break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":this._open_number=!0,this._streamNumbers&&(this.push({name:"startNumber"}),this.push({name:"numberChunk",value:s})),this._packNumbers&&(this._accumulator=s),this._expect="numberDigit";break;case"true":case"false":case"null":if(this._buffer.length-a===s.length&&!this._done)break e;this.push({name:s+"Value",value:Kr[s]}),this._expect=B[this._parent];break}E?this._buffer=this._buffer.slice(s.length):a+=s.length;break;case"keyVal":case"string":if(u.string.lastIndex=a,t=u.string.exec(this._buffer),!t){if(a<this._buffer.length&&(this._done||this._buffer.length-a>=6))return e(new Error("Parser cannot parse input: escaped characters"));if(this._done)return e(new Error("Parser has expected a string value"));break e}if(s=t[0],s==='"')this._expect==="keyVal"?(this._streamKeys&&this.push({name:"endKey"}),this._packKeys&&(this.push({name:"keyValue",value:this._accumulator}),this._accumulator=""),this._expect="colon"):(this._streamStrings&&this.push({name:"endString"}),this._packStrings&&(this.push({name:"stringValue",value:this._accumulator}),this._accumulator=""),this._expect=B[this._parent]);else if(s.length>1&&s.charAt(0)==="\\"){let n=s.length==2?Hr[s.charAt(1)]:Gr(s);(this._expect==="keyVal"?this._streamKeys:this._streamStrings)&&this.push({name:"stringChunk",value:n}),(this._expect==="keyVal"?this._packKeys:this._packStrings)&&(this._accumulator+=n)}else(this._expect==="keyVal"?this._streamKeys:this._streamStrings)&&this.push({name:"stringChunk",value:s}),(this._expect==="keyVal"?this._packKeys:this._packStrings)&&(this._accumulator+=s);E?this._buffer=this._buffer.slice(s.length):a+=s.length;break;case"key1":case"key":if(u.key1.lastIndex=a,t=u.key1.exec(this._buffer),!t){if(a<this._buffer.length||this._done)return e(new Error("Parser cannot parse input: expected an object key"));break e}if(s=t[0],s==='"')this._streamKeys&&this.push({name:"startKey"}),this._expect="keyVal";else if(s==="}"){if(this._expect!=="key1")return e(new Error("Parser cannot parse input: unexpected token '}'"));this.push({name:"endObject"}),this._parent=this._stack.pop(),this._expect=B[this._parent]}E?this._buffer=this._buffer.slice(s.length):a+=s.length;break;case"colon":if(u.colon.lastIndex=a,t=u.colon.exec(this._buffer),!t){if(a<this._buffer.length||this._done)return e(new Error("Parser cannot parse input: expected ':'"));break e}s=t[0],s===":"&&(this._expect="value"),E?this._buffer=this._buffer.slice(s.length):a+=s.length;break;case"arrayStop":case"objectStop":if(u.comma.lastIndex=a,t=u.comma.exec(this._buffer),!t){if(a<this._buffer.length||this._done)return e(new Error("Parser cannot parse input: expected ','"));break e}if(this._open_number&&(this._streamNumbers&&this.push({name:"endNumber"}),this._open_number=!1,this._packNumbers&&(this.push({name:"numberValue",value:this._accumulator}),this._accumulator="")),s=t[0],s===",")this._expect=this._expect==="arrayStop"?"value":"key";else if(s==="}"||s==="]"){if(s==="}"?this._expect==="arrayStop":this._expect!=="arrayStop")return e(new Error("Parser cannot parse input: expected '"+(this._expect==="arrayStop"?"]":"}")+"'"));this.push({name:s==="}"?"endObject":"endArray"}),this._parent=this._stack.pop(),this._expect=B[this._parent]}E?this._buffer=this._buffer.slice(s.length):a+=s.length;break;case"numberStart":if(u.numberStart.lastIndex=a,t=u.numberStart.exec(this._buffer),!t){if(a<this._buffer.length||this._done)return e(new Error("Parser cannot parse input: expected a starting digit"));break e}s=t[0],this._streamNumbers&&this.push({name:"numberChunk",value:s}),this._packNumbers&&(this._accumulator+=s),this._expect=s==="0"?"numberFraction":"numberDigit",E?this._buffer=this._buffer.slice(s.length):a+=s.length;break;case"numberDigit":if(u.numberDigit.lastIndex=a,t=u.numberDigit.exec(this._buffer),!t){if(a<this._buffer.length||this._done)return e(new Error("Parser cannot parse input: expected a digit"));break e}if(s=t[0],s)this._streamNumbers&&this.push({name:"numberChunk",value:s}),this._packNumbers&&(this._accumulator+=s),E?this._buffer=this._buffer.slice(s.length):a+=s.length;else{if(a<this._buffer.length){this._expect="numberFraction";break}if(this._done){this._expect=B[this._parent];break}break e}break;case"numberFraction":if(u.numberFraction.lastIndex=a,t=u.numberFraction.exec(this._buffer),!t){if(a<this._buffer.length||this._done){this._expect=B[this._parent];break}break e}s=t[0],this._streamNumbers&&this.push({name:"numberChunk",value:s}),this._packNumbers&&(this._accumulator+=s),this._expect=s==="."?"numberFracStart":"numberExpSign",E?this._buffer=this._buffer.slice(s.length):a+=s.length;break;case"numberFracStart":if(u.numberFracStart.lastIndex=a,t=u.numberFracStart.exec(this._buffer),!t){if(a<this._buffer.length||this._done)return e(new Error("Parser cannot parse input: expected a fractional part of a number"));break e}s=t[0],this._streamNumbers&&this.push({name:"numberChunk",value:s}),this._packNumbers&&(this._accumulator+=s),this._expect="numberFracDigit",E?this._buffer=this._buffer.slice(s.length):a+=s.length;break;case"numberFracDigit":if(u.numberFracDigit.lastIndex=a,t=u.numberFracDigit.exec(this._buffer),s=t[0],s)this._streamNumbers&&this.push({name:"numberChunk",value:s}),this._packNumbers&&(this._accumulator+=s),E?this._buffer=this._buffer.slice(s.length):a+=s.length;else{if(a<this._buffer.length){this._expect="numberExponent";break}if(this._done){this._expect=B[this._parent];break}break e}break;case"numberExponent":if(u.numberExponent.lastIndex=a,t=u.numberExponent.exec(this._buffer),!t){if(a<this._buffer.length){this._expect=B[this._parent];break}if(this._done){this._expect="done";break}break e}s=t[0],this._streamNumbers&&this.push({name:"numberChunk",value:s}),this._packNumbers&&(this._accumulator+=s),this._expect="numberExpSign",E?this._buffer=this._buffer.slice(s.length):a+=s.length;break;case"numberExpSign":if(u.numberExpSign.lastIndex=a,t=u.numberExpSign.exec(this._buffer),!t){if(a<this._buffer.length){this._expect="numberExpStart";break}if(this._done)return e(new Error("Parser has expected an exponent value of a number"));break e}s=t[0],this._streamNumbers&&this.push({name:"numberChunk",value:s}),this._packNumbers&&(this._accumulator+=s),this._expect="numberExpStart",E?this._buffer=this._buffer.slice(s.length):a+=s.length;break;case"numberExpStart":if(u.numberExpStart.lastIndex=a,t=u.numberExpStart.exec(this._buffer),!t){if(a<this._buffer.length||this._done)return e(new Error("Parser cannot parse input: expected an exponent part of a number"));break e}s=t[0],this._streamNumbers&&this.push({name:"numberChunk",value:s}),this._packNumbers&&(this._accumulator+=s),this._expect="numberExpDigit",E?this._buffer=this._buffer.slice(s.length):a+=s.length;break;case"numberExpDigit":if(u.numberExpDigit.lastIndex=a,t=u.numberExpDigit.exec(this._buffer),s=t[0],s)this._streamNumbers&&this.push({name:"numberChunk",value:s}),this._packNumbers&&(this._accumulator+=s),E?this._buffer=this._buffer.slice(s.length):a+=s.length;else{if(a<this._buffer.length||this._done){this._expect=B[this._parent];break}break e}break;case"done":if(u.ws.lastIndex=a,t=u.ws.exec(this._buffer),!t){if(a<this._buffer.length){if(this._jsonStreaming){this._expect="value";break}return e(new Error("Parser cannot parse input: unexpected characters"))}break e}s=t[0],this._open_number&&(this._streamNumbers&&this.push({name:"endNumber"}),this._open_number=!1,this._packNumbers&&(this.push({name:"numberValue",value:this._accumulator}),this._accumulator="")),E?this._buffer=this._buffer.slice(s.length):a+=s.length;break}!E&&(this._buffer=this._buffer.slice(a)),e(null)}};ae.parser=ae.make;ae.make.Constructor=ae;Tt.exports=ae});var It=A((Js,Rt)=>{"use strict";var qr=r=>r.on("data",e=>r.emit(e.name,e.value));Rt.exports=qr});var Ye=A((Zs,Ut)=>{"use strict";var Je=qe(),Jr=It(),Ze=r=>Jr(new Je(r));Ze.Parser=Je;Ze.parser=Je.parser;Ut.exports=Ze});var et=A((Ys,Mt)=>{"use strict";var{Transform:Zr}=require("stream"),W=class r extends Zr{static stringFilter(e,t){return s=>{let a=s.join(t);return a.length===e.length&&a===e||a.length>e.length&&a.substr(0,e.length)===e&&a.substr(e.length,t.length)===t}}static regExpFilter(e,t){return s=>e.test(s.join(t))}static arrayReplacement(e){return()=>e}constructor(e){super(Object.assign({},e,{writableObjectMode:!0,readableObjectMode:!0})),this._transform=this._check,this._stack=[];let t=e&&e.filter,s=e&&e.pathSeparator||".";typeof t=="string"?this._filter=r.stringFilter(t,s):typeof t=="function"?this._filter=t:t instanceof RegExp&&(this._filter=r.regExpFilter(t,s));let a=e&&e.replacement;typeof a=="function"?this._replacement=a:this._replacement=r.arrayReplacement(a||r.defaultReplacement),this._allowEmptyReplacement=e&&e.allowEmptyReplacement,this._streamKeys=!0,e&&("streamValues"in e&&(this._streamKeys=e.streamValues),"streamKeys"in e&&(this._streamKeys=e.streamKeys)),this._once=e&&e.once,this._previousToken=""}_check(e,t,s){switch(e.name){case"startObject":case"startArray":case"startString":case"startNumber":case"nullValue":case"trueValue":case"falseValue":typeof this._stack[this._stack.length-1]=="number"&&++this._stack[this._stack.length-1];break;case"keyValue":this._stack[this._stack.length-1]=e.value;break;case"numberValue":this._previousToken!=="endNumber"&&typeof this._stack[this._stack.length-1]=="number"&&++this._stack[this._stack.length-1];break;case"stringValue":this._previousToken!=="endString"&&typeof this._stack[this._stack.length-1]=="number"&&++this._stack[this._stack.length-1];break}if(this._previousToken=e.name,this._checkChunk(e))return s(null);switch(e.name){case"startObject":this._stack.push(null);break;case"startArray":this._stack.push(-1);break;case"endObject":case"endArray":this._stack.pop();break}s(null)}_passObject(e,t,s){switch(this.push(e),e.name){case"startObject":case"startArray":++this._depth;break;case"endObject":case"endArray":--this._depth;break}this._depth||(this._transform=this._once?this._skip:this._check),s(null)}_pass(e,t,s){this.push(e),s(null)}_skipObject(e,t,s){switch(e.name){case"startObject":case"startArray":++this._depth;break;case"endObject":case"endArray":--this._depth;break}this._depth||(this._transform=this._once?this._pass:this._check),s(null)}_skip(e,t,s){s(null)}};W.defaultReplacement=[{name:"nullValue",value:null}];var Xe=(r,e)=>function(t,s,a){if(this._expected){let n=this._expected;if(this._expected="",this._transform=this._once?this._skip:this._check,n===t.name)this.push(t);else return this._transform(t,s,a)}else this.push(t),t.name===r&&(this._expected=e);a(null)};W.prototype._passNumber=Xe("endNumber","numberValue");W.prototype._passString=Xe("endString","stringValue");W.prototype._passKey=Xe("endKey","keyValue");var Qe=(r,e)=>function(t,s,a){if(this._expected){let n=this._expected;if(this._expected="",this._transform=this._once?this._pass:this._check,n!==t.name)return this._transform(t,s,a)}else t.name===r&&(this._expected=e);a(null)};W.prototype._skipNumber=Qe("endNumber","numberValue");W.prototype._skipString=Qe("endString","stringValue");W.prototype._skipKey=Qe("endKey","keyValue");Mt.exports=W});var ke=A((Xs,Ot)=>{"use strict";var{chain:Yr}=Ie(),Xr=qe(),Qr=(r,e)=>Yr([new Xr(e),r(e)],Object.assign({},e,{writableObjectMode:!1,readableObjectMode:!0}));Ot.exports=Qr});var Nt=A((Qs,Dt)=>{"use strict";var es=et(),ts=ke(),ne=class r extends es{static make(e){return new r(e)}static withParser(e){return ts(r.make,e)}constructor(e){super(e),this._once=!1,this._lastStack=[]}_flush(e){this._syncStack(),e(null)}_checkChunk(e){switch(e.name){case"startObject":this._filter(this._stack,e)&&(this._syncStack(),this.push(e),this._lastStack.push(null));break;case"startArray":this._filter(this._stack,e)&&(this._syncStack(),this.push(e),this._lastStack.push(-1));break;case"nullValue":case"trueValue":case"falseValue":case"stringValue":case"numberValue":this._filter(this._stack,e)&&(this._syncStack(),this.push(e));break;case"startString":this._filter(this._stack,e)?(this._syncStack(),this.push(e),this._transform=this._passString):this._transform=this._skipString;break;case"startNumber":this._filter(this._stack,e)?(this._syncStack(),this.push(e),this._transform=this._passNumber):this._transform=this._skipNumber;break}return!1}_syncStack(){let e=this._stack,t=this._lastStack,s=e.length,a=t.length,n=0;for(let f=Math.min(s,a);n<f&&e[n]===t[n];++n);for(let f=a-1;f>n;--f)this.push({name:typeof t[f]=="number"?"endArray":"endObject"});if(n<a)if(n<s){if(typeof e[n]=="string"){let f=e[n];this._streamKeys&&(this.push({name:"startKey"}),this.push({name:"stringChunk",value:f}),this.push({name:"endKey"})),this.push({name:"keyValue",value:f})}++n}else this.push({name:typeof t[n]=="number"?"endArray":"endObject"});for(let f=n;f<s;++f){let g=e[f];typeof g=="number"?g>=0&&this.push({name:"startArray"}):typeof g=="string"&&(this.push({name:"startObject"}),this._streamKeys&&(this.push({name:"startKey"}),this.push({name:"stringChunk",value:g}),this.push({name:"endKey"})),this.push({name:"keyValue",value:g}))}this._lastStack=Array.prototype.concat.call(e)}};ne.filter=ne.make;ne.make.Constructor=ne;Dt.exports=ne});var Vt=A((ea,Lt)=>{"use strict";var rs=require("events"),Ft=r=>function(){this.done?this.done=!1:this.stack.push(this.current,this.key),this.current=new r,this.key=null},q=class r extends rs{static connectTo(e,t){return new r(t).connectTo(e)}constructor(e){super(),this.stack=[],this.current=this.key=null,this.done=!0,e&&(this.reviver=typeof e.reviver=="function"&&e.reviver,this.reviver&&(this.stringValue=this._saveValue=this._saveValueWithReviver),e.numberAsString&&(this.numberValue=this.stringValue))}connectTo(e){return e.on("data",t=>{this[t.name]&&(this[t.name](t.value),this.done&&this.emit("done",this))}),this}get depth(){return(this.stack.length>>1)+(this.done?0:1)}get path(){let e=[];for(let t=0;t<this.stack.length;t+=2){let s=this.stack[t+1];e.push(s===null?this.stack[t].length:s)}return e}dropToLevel(e){if(e<this.depth)if(e){let t=e-1<<1;this.current=this.stack[t],this.key=this.stack[t+1],this.stack.splice(t)}else this.stack=[],this.current=this.key=null,this.done=!0;return this}consume(e){return this[e.name]&&this[e.name](e.value),this}keyValue(e){this.key=e}numberValue(e){this._saveValue(parseFloat(e))}nullValue(){this._saveValue(null)}trueValue(){this._saveValue(!0)}falseValue(){this._saveValue(!1)}endObject(){if(this.stack.length){let e=this.current;this.key=this.stack.pop(),this.current=this.stack.pop(),this._saveValue(e)}else this.done=!0}_saveValue(e){this.done?this.current=e:this.current instanceof Array?this.current.push(e):(this.current[this.key]=e,this.key=null)}_saveValueWithReviver(e){this.done?this.current=this.reviver("",e):this.current instanceof Array?(e=this.reviver(""+this.current.length,e),this.current.push(e),e===void 0&&delete this.current[this.current.length-1]):(e=this.reviver(this.key,e),e!==void 0&&(this.current[this.key]=e),this.key=null)}};q.prototype.stringValue=q.prototype._saveValue;q.prototype.startObject=Ft(Object);q.prototype.startArray=Ft(Array);q.prototype.endArray=q.prototype.endObject;Lt.exports=q});var st=A((ta,jt)=>{"use strict";var{Transform:ss}=require("stream"),as=Vt(),tt=class{constructor(e){this.depth=e}startObject(){++this.depth}endObject(){--this.depth}startArray(){++this.depth}endArray(){--this.depth}},rt=class extends ss{constructor(e){super(Object.assign({},e,{writableObjectMode:!0,readableObjectMode:!0})),e&&(this.objectFilter=e.objectFilter,this.includeUndecided=e.includeUndecided),typeof this.objectFilter!="function"&&(this._filter=this._transform),this._transform=this._wait||this._filter,this._assembler=new as(e)}_transform(e,t,s){this._assembler[e.name]&&(this._assembler[e.name](e.value),this._assembler.depth===this._level&&this._push()),s(null)}_filter(e,t,s){if(this._assembler[e.name]){this._assembler[e.name](e.value);let a=this.objectFilter(this._assembler);if(a)return this._assembler.depth===this._level&&(this._push(),this._transform=this._filter),this._transform=this._accept,s(null);if(a===!1)return this._saved_assembler=this._assembler,this._assembler=new tt(this._saved_assembler.depth),this._saved_assembler.dropToLevel(this._level),this._assembler.depth===this._level&&(this._assembler=this._saved_assembler,this._transform=this._filter),this._transform=this._reject,s(null);this._assembler.depth===this._level&&this._push(!this.includeUndecided)}s(null)}_accept(e,t,s){this._assembler[e.name]&&(this._assembler[e.name](e.value),this._assembler.depth===this._level&&(this._push(),this._transform=this._filter)),s(null)}_reject(e,t,s){this._assembler[e.name]&&(this._assembler[e.name](e.value),this._assembler.depth===this._level&&(this._assembler=this._saved_assembler,this._transform=this._filter)),s(null)}};jt.exports=rt});var Wt=A((ra,Bt)=>{"use strict";var ns=st(),is=ke(),ie=class r extends ns{static make(e){return new r(e)}static withParser(e){return is(r.make,e)}constructor(e){super(e),this._level=1,this._counter=0}_wait(e,t,s){return e.name!=="startArray"?s(new Error("Top-level object should be an array.")):(this._transform=this._filter,this._transform(e,t,s))}_push(e){this._assembler.current.length&&(e?(++this._counter,this._assembler.current.pop()):this.push({key:this._counter++,value:this._assembler.current.pop()}))}};ie.streamArray=ie.make;ie.make.Constructor=ie;Bt.exports=ie});var or=A((Aa,ir)=>{"use strict";var ps=et(),ms=ke(),oe=class r extends ps{static make(e){return new r(e)}static withParser(e){return ms(r.make,e)}_checkChunk(e){switch(e.name){case"startObject":case"startArray":if(this._filter(this._stack,e))return this.push(e),this._transform=this._passObject,this._depth=1,!0;break;case"startString":if(this._filter(this._stack,e))return this.push(e),this._transform=this._passString,!0;break;case"startNumber":if(this._filter(this._stack,e))return this.push(e),this._transform=this._passNumber,!0;break;case"nullValue":case"trueValue":case"falseValue":case"stringValue":case"numberValue":if(this._filter(this._stack,e))return this.push(e),this._transform=this._once?this._skip:this._check,!0;break}return!1}};oe.pick=oe.make;oe.make.Constructor=oe;ir.exports=oe});var lr=A((Ta,cr)=>{"use strict";var gs=st(),bs=ke(),ce=class r extends gs{static make(e){return new r(e)}static withParser(e){return bs(r.make,e)}constructor(e){super(e),this._level=1,this._lastKey=null}_wait(e,t,s){return e.name!=="startObject"?s(new Error("Top-level object should be an object.")):(this._transform=this._filter,this._transform(e,t,s))}_push(e){this._lastKey===null?this._lastKey=this._assembler.key:(!e&&this.push({key:this._lastKey,value:this._assembler.current[this._lastKey]}),this._assembler.current={},this._lastKey=null)}};ce.streamObject=ce.make;ce.make.Constructor=ce;cr.exports=ce});var Is={};xr(Is,{default:()=>gr});module.exports=$r(Is);var T=require("react"),c=require("@raycast/api");var re=U(require("react")),S=require("@raycast/api");var dt=require("react/jsx-runtime");function ft(r,e,t,s){let a=(s-90)*Math.PI/180;return{x:r+t*Math.cos(a),y:e+t*Math.sin(a)}}function Sr(r,e,t,s,a){let n=ft(r,e,t,a),f=ft(r,e,t,s),g=a-s<=180?"0":"1";return["M",n.x,n.y,"A",t,t,0,g,0,f.x,f.y].join(" ")}function Fe(r,e=S.Color.Red,t){let s=t?.background||(S.environment.appearance==="light"?"black":"white"),a=t?.backgroundOpacity||.1,n=10,g=50-5-n/2,I=`<svg xmlns="http://www.w3.org/2000/svg" width="100px" height="100px">
      <circle cx="50" cy="50" r="${g}" stroke-width="${n}" stroke="${r<1?s:e}" opacity="${r<1?a:"1"}" fill="none" />
      ${r>0&&r<1?`<path d="${Sr(50,50,g,0,r*360)}" stroke="${e}" stroke-width="${n}" fill="none" />`:""}
    </svg>
  `.replaceAll(`
`,"");return`data:image/svg+xml,${encodeURIComponent(I)}`}var ht=require("@raycast/api"),v=(0,ht.getPreferenceValues)();var wt=U(je()),se=new wt.Logger({prefix:"[Brew]"}),F=se.child("[Commands]"),ge=se.child("[Cache]"),k=se.child("[Actions]"),Be=se.child("[Fetch]"),_t=se.child("[Search]"),fe=se.child("[UI]");var M=class extends Error{constructor(e,t){super(e),this.name="BrewError",this.brewCause=t?.cause}},de=class extends M{constructor(e,t){super(e,{cause:t?.cause}),this.name="NetworkError",this.statusCode=t?.statusCode,this.url=t?.url}};var he=class extends M{constructor(e,t){super(e,{cause:t?.cause}),this.name="BrewCommandError",this.command=t?.command,this.exitCode=t?.exitCode,this.stderr=t?.stderr}},ve=class extends M{constructor(e,t){super(e,{cause:t?.cause}),this.name="BrewNotFoundError",this.path=t?.path}};var j=class extends M{constructor(e,t){super(e,{cause:t?.cause}),this.name="BrewLockError",this.command=t?.command}},be=class extends M{constructor(e,t){super(e,{cause:t?.cause}),this.name="DownloadTimeoutError",this.packageName=t?.packageName,this.phase=t?.phase,this.timeoutMs=t?.timeoutMs,this.elapsedMs=t?.elapsedMs}},K=class extends M{constructor(e,t){super(e,{cause:t?.cause}),this.name="StaleProcessError",this.packageName=t?.packageName,this.lastPhase=t?.lastPhase,this.staleDurationMs=t?.staleDurationMs}},Ee=class extends M{constructor(e,t){super(e,{cause:t?.cause}),this.name="PackageNotFoundError",this.packageName=t?.packageName,this.packageType=t?.packageType}},Ce=class extends M{constructor(e,t){super(e,{cause:t?.cause}),this.name="PackageDisabledError",this.packageName=t?.packageName,this.packageType=t?.packageType,this.disabledDate=t?.disabledDate,this.reason=t?.reason}},Pe=class extends M{constructor(e,t){super(e,{cause:t?.cause}),this.name="PackageConflictError",this.packageName=t?.packageName,this.conflictsWith=t?.conflictsWith}},Ae=class extends M{constructor(e,t){super(e,{cause:t?.cause}),this.name="UnsupportedMacOSError",this.packageName=t?.packageName,this.requiredVersion=t?.requiredVersion,this.currentVersion=t?.currentVersion}};function ze(r){return r instanceof de}function ye(r){return r instanceof j}function xt(r){return r instanceof be}function $t(r){return r instanceof K}function G(r){return ze(r)||ye(r)||xt(r)||$t(r)}var Cr=[/lockf:.*already locked/i,/another active Homebrew/i,/another brew process/i,/another.*brew.*update.*process/i,/Homebrew is already running/i,/Error: Another active Homebrew/i,/Error: Another.*brew.*process/i,/waiting for lock/i,/lock file/i,/has already locked/i,/brew upgrade.*process has already/i],Pr=/Error: (Cask|Formula) '([^']+)' has been disabled(?: because (.+?))?(?:! It was disabled on (\d{4}-\d{2}-\d{2}))?/i;function Te(r){return Cr.some(e=>e.test(r))}function We(r){let e=r.match(Pr);return e?{packageType:e[1].toLowerCase(),packageName:e[2],reason:e[3]?.trim(),disabledDate:e[4]}:null}function Re(r){return r instanceof Error?r:new Error(String(r))}function H(r){if(r instanceof j)return"Another brew process is already running. Please wait for it to finish and try again.";if(r instanceof be){let e=r.packageName?` for "${r.packageName}"`:"",t=r.phase?` during ${r.phase}`:"";return`Download timed out${e}${t}. Please try again.`}if(r instanceof K){let e=r.packageName?` for "${r.packageName}"`:"",t=r.lastPhase?` (stuck at ${r.lastPhase})`:"";return`Process appears stuck${e}${t}. The operation was cancelled.`}if(r instanceof Ce){let e=r.packageType??"package",s=`${e.charAt(0).toUpperCase()+e.slice(1)} "${r.packageName}" has been discontinued`;return r.reason&&(s+=`: ${r.reason}`),r.disabledDate&&(s+=` (disabled on ${r.disabledDate})`),s}if(r instanceof Pe){let e=r.conflictsWith?.join(", ")??"another package";return`"${r.packageName}" conflicts with ${e}. Please uninstall the conflicting package first.`}if(r instanceof Ae){let e=`"${r.packageName}" requires a different macOS version`;return r.requiredVersion&&(e+=` (requires ${r.requiredVersion})`),e}if(r instanceof de)return r.statusCode?`Network error (HTTP ${r.statusCode}): ${r.message}`:`Network error: ${r.message}`;if(r instanceof ve)return`Homebrew not found: ${r.message}`;if(r instanceof Ee){let e=r.packageType??"package";return`${e.charAt(0).toUpperCase()+e.slice(1)} not found: ${r.packageName??r.message}`}if(r instanceof he){if(r.exitCode===void 0||r.exitCode===null)return"Cancelled";if(r.stderr){let e=We(r.stderr);if(e){let t=`${e.packageType.charAt(0).toUpperCase()+e.packageType.slice(1)} "${e.packageName}" has been discontinued`;return e.reason&&(t+=`: ${e.reason}`),e.disabledDate&&(t+=` (disabled on ${e.disabledDate})`),t}}return r.stderr??r.message}if(r instanceof M)return r.message;if(r instanceof Error){if(r.name==="AbortError")return"Cancelled";let e=r;if(e.stderr){let t=We(e.stderr);if(t){let s=`${t.packageType.charAt(0).toUpperCase()+t.packageType.slice(1)} "${t.packageName}" has been discontinued`;return t.reason&&(s+=`: ${t.reason}`),t.disabledDate&&(s+=` (disabled on ${t.disabledDate})`),s}return e.stderr}return r.message}return String(r)}var pe=require("@raycast/api"),at=U(require("path")),zt=U(require("fs"));var ls=U(Ie()),us=U(Ye()),fs=U(Nt()),ds=U(Wt());var Kt=(()=>{try{zt.default.mkdirSync(pe.environment.supportPath,{recursive:!0})}catch{ge.warn("Failed to create supportPath")}return pe.environment.supportPath})(),nt=pe.environment.supportPath.split(at.default.sep).find(r=>!!r.startsWith("com.raycast"))??"com.raycast.macos";function we(r){return at.default.join(Kt,r)}var J=require("@raycast/api");async function it(r,e,t){if(e.name==="AbortError"){fe.log("Operation aborted by user");return}let s=e,a=H(e),n=ye(e);fe.error(r,{errorType:e.name,message:e.message,stderr:s.stderr,code:s.code,recoverable:G(e),isLockError:n});let f=n?"Brew is Busy":r,g={style:J.Toast.Style.Failure,title:f,message:a,primaryAction:{title:"Copy Logs",onAction:()=>{let O=n?`${f}
${a}

Tip: Check Activity Monitor or run 'ps aux | grep brew' in Terminal to see what's running.`:a;J.Clipboard.copy(O)}}};if(G(e)&&t?.retryAction){let O=t.retryAction;g.secondaryAction={title:"Retry",onAction:async p=>{p.style=J.Toast.Style.Animated,p.title="Retrying...",p.message=void 0;try{await O(),p.style=J.Toast.Style.Success,p.title="Success"}catch(b){p.style=J.Toast.Style.Failure,p.title=ye(b)?"Brew is Busy":r,p.message=H(b)}}}}await new J.Toast(g).show()}Array.prototype.first||(Array.prototype.first=function(){return this.at(0)});Array.prototype.last||(Array.prototype.last=function(){return this.at(-1)});Array.prototype.isTruncated||(Array.prototype.isTruncated=function(){return this.totalLength?this.length<this.totalLength:!1});String.ellipsis||(String.ellipsis="\u2026");function Gt(r,e,t){return r===1?e:t??`${e}s`}function Ue(r,e,t){return`${r} ${Gt(r,e,t)}`}var Ht=U(je()),hs=new Ht.Logger({prefix:"[Brew]"}).child("[Memory]");var qt=require("child_process"),ot=require("path"),Jt=require("os");var Zt=(()=>{if(v.customBrewPath&&v.customBrewPath.length>0)return(0,ot.join)(v.customBrewPath,"..","..");try{return(0,qt.execSync)("brew --prefix",{encoding:"utf8"}).trim()}catch{return(0,Jt.cpus)()[0]?.model?.includes("Apple")?"/opt/homebrew":"/usr/local"}})(),Me=r=>(0,ot.join)(Zt,r),_e=()=>Me("bin/brew");var Xt=require("child_process"),Qt=require("util"),er=require("fs"),Oe=U(require("fs/promises")),tr=require("path"),rr=require("@raycast/api");var xa=(0,Qt.promisify)(Xt.exec),Yt=!1;async function ct(){let r=(0,tr.join)(rr.environment.assetsPath,"askpass.sh");try{await Oe.access(r,er.constants.X_OK)}catch{await Oe.chmod(r,493)}let e={...process.env};e.SUDO_ASKPASS=r,e.HOMEBREW_BROWSER=nt;let t=v.disableDownloadConcurrency;t&&(e.HOMEBREW_DOWNLOAD_CONCURRENCY="1");let s=v.useInternalApi;return s&&(e.HOMEBREW_USE_INTERNAL_API="1"),Yt||(Yt=!0,F.log("Homebrew 5.0 Configuration",{downloadConcurrencyEnabled:!t,downloadConcurrencyMode:t?"sequential (1)":"parallel (auto)",internalApiEnabled:s,verboseLogging:v.verboseLogging})),e}var sr=require("child_process");var De=300*1e3,ar=600*1e3;function nr(r){let e=r.trim();if(!e)return null;let t=e.replace(/^=+>\s*/,"");if(e.includes("Downloading"))return{phase:"downloading",message:t};let s=e.match(/#+\s*(\d+\.?\d*)%/);return s?{phase:"downloading",message:`Downloading... ${s[1]}%`,percentage:parseFloat(s[1])}:e.includes("Verifying")||e.includes("checksum")?{phase:"verifying",message:t}:e.includes("Pouring")||e.includes("Extracting")?{phase:"extracting",message:t}:e.includes("Installing")||e.includes("==> Installing")?{phase:"installing",message:t}:e.includes("Linking")||e.includes("==> Linking")?{phase:"linking",message:t}:e.includes("Cleaning")||e.includes("Removing")?{phase:"cleaning",message:t}:e.includes("==> Caveats")||e.includes("==> Summary")?{phase:"complete",message:t}:e.startsWith("==>")?{phase:"installing",message:t}:null}async function te(r,e,t,s){let a=await ct(),n=r.split(/\s+/).filter(Boolean),f=s?.staleTimeoutMs??De,g=s?.packageName,I=s?.verboseLogging??!1;return F.log("Executing brew with progress",{command:r,packageName:g,staleTimeoutMs:f}),new Promise((O,p)=>{let b=(0,sr.spawn)(_e(),n,{env:a,stdio:["ignore","pipe","pipe"]}),w="",y="",X=Date.now(),C="starting",Q=null,D=!1,i=()=>{Q&&(clearInterval(Q),Q=null)},h=m=>{D||(D=!0,i(),b.kill("SIGTERM"),p(m))};Q=setInterval(()=>{let d=Date.now()-X,l=C==="downloading"?ar:f;d>l?(F.warn("Stale process detected",{command:r,packageName:g,lastPhase:C,staleDurationMs:d,timeoutMs:l}),h(new K(`Process appears stuck during ${C}`,{packageName:g,lastPhase:C,staleDurationMs:d}))):I&&F.log("Stale check passed",{command:r,phase:C,timeSinceLastProgress:d,timeout:l})},3e4),t&&t.addEventListener("abort",()=>{if(D)return;D=!0,i(),b.kill("SIGTERM");let m=new Error("Cancelled");m.name="AbortError",p(m)}),e?.({phase:"starting",message:`Running: brew ${r.trim()}`});let $=(m,d)=>{X=Date.now();let l=m.split(`
`);for(let R of l){let N=nr(R);N?(N.phase!==C&&(F.log("Phase transition",{command:r,packageName:g,from:C,to:N.phase,message:N.message}),C=N.phase),e?.(N)):I&&R.trim()&&F.log(`Unparsed ${d}`,{line:R.trim()})}};b.stdout?.on("data",m=>{let d=m.toString();w+=d,$(d,"stdout")}),b.stderr?.on("data",m=>{let d=m.toString();if(y+=d,Te(d)){h(new j("Another brew process is already running",{command:r}));return}$(d,"stderr")}),b.on("close",m=>{i(),!D&&(F.log("Command completed",{command:r,packageName:g,exitCode:m,finalPhase:C}),m===0?(e?.({phase:"complete",message:"Operation completed successfully"}),O({stdout:w,stderr:y})):(e?.({phase:"error",message:`Command failed with exit code ${m}`}),p(new he(`brew ${r} failed with exit code ${m}`,{command:r,exitCode:m??void 0,stderr:y}))))}),b.on("error",m=>{i(),!D&&(e?.({phase:"error",message:m.message}),p(m))})})}var ws=U(Ie()),_s=U(Ye()),xs=U(or()),$s=U(lr());var ja=we("installedv2.json"),Ba=we("formula.json"),Wa=we("cask.json");async function lt(r,e,t,s){let a=[],n="",f=s?.prefetch??!0,g=s?.continueOnError??!0,I=s?.staleTimeoutMs??De,O=v.verboseLogging??!1,p={id:"update",title:"Updating Homebrew",status:"running",startTime:Date.now()};a.push(p),e?.(a,n);try{await te("update",i=>{p.message=i.message,p.currentPhase=i.phase,e?.(a,n)},t,{staleTimeoutMs:I,verboseLogging:O}),p.status="completed",p.endTime=Date.now(),e?.(a,n)}catch(i){return p.status="failed",p.endTime=Date.now(),p.error=i instanceof Error?i:new Error(String(i)),p.message=H(i),p.isRecoverable=G(i),k.error("Homebrew update failed",{error:p.message,isRecoverable:p.isRecoverable}),{success:!1,steps:a,error:p.error}}let b={id:"check",title:"Checking for outdated packages",status:"running",startTime:Date.now()};a.push(b),e?.(a,n);let w;try{let i="outdated --json=v2";r&&(i+=" --greedy");let h=await te(i,void 0,t,{staleTimeoutMs:I,verboseLogging:O});w=JSON.parse(h.stdout),b.status="completed",b.endTime=Date.now(),b.message=`Found ${Ue(w.formulae.length,"formula","formulae")} and ${Ue(w.casks.length,"cask")}`,e?.(a,n)}catch(i){return b.status="failed",b.endTime=Date.now(),b.error=i instanceof Error?i:new Error(String(i)),b.message=H(i),b.isRecoverable=G(i),{success:!1,steps:a,error:b.error}}if(w.formulae.length===0&&w.casks.length===0)return k.log("No packages to upgrade"),{success:!0,steps:a};let y=[...w.formulae.map(i=>({id:`formula-${i.name}`,title:i.name,subtitle:`${i.installed_versions[0]||"?"} \u2192 ${i.current_version}`,status:"pending"})),...w.casks.map(i=>({id:`cask-${i.name}`,title:i.name,subtitle:`${i.installed_versions} \u2192 ${i.current_version}`,status:"pending"}))];if(a.push(...y),e?.(a,n),k.log("Starting batch upgrade",{totalPackages:y.length,formulae:w.formulae.length,casks:w.casks.length,prefetch:f,continueOnError:g}),f&&y.length>1){let i={id:"fetch",title:"Pre-fetching downloads",subtitle:`${y.length} packages`,status:"running",startTime:Date.now()},h=a.indexOf(b)+1;a.splice(h,0,i),e?.(a,n);try{let $=w.formulae.map(l=>l.name),m=w.casks.map(l=>`--cask ${l.name}`),d=[...$,...m.map(l=>l.split(" ")[1])];$.length>0&&(i.message=`Fetching ${$.length} formulae...`,i.currentPhase="downloading",e?.(a,n),await te(`fetch ${$.join(" ")}`,l=>{i.message=l.message,i.currentPhase=l.phase,n+=l.message+`
`,e?.(a,n)},t,{staleTimeoutMs:I,verboseLogging:O})),w.casks.length>0&&(i.message=`Fetching ${w.casks.length} casks...`,i.currentPhase="downloading",e?.(a,n),await te(`fetch --cask ${w.casks.map(l=>l.name).join(" ")}`,l=>{i.message=l.message,i.currentPhase=l.phase,n+=l.message+`
`,e?.(a,n)},t,{staleTimeoutMs:I,verboseLogging:O})),i.status="completed",i.endTime=Date.now(),i.message=`Pre-fetched ${d.length} packages`,k.log("Pre-fetch completed",{packages:d.length})}catch($){i.status="failed",i.endTime=Date.now(),i.error=$ instanceof Error?$:new Error(String($)),i.message=`Pre-fetch failed: ${H($)}`,i.isRecoverable=!0,k.warn("Pre-fetch failed, continuing with upgrades",{error:i.message})}e?.(a,n)}let X=!1;for(let i=0;i<y.length;i++){if(t?.aborted){let d=y.length-i;k.log("Upgrade cancelled by user",{completedPackages:i,remainingPackages:d,totalPackages:y.length});for(let l=i;l<y.length;l++)y[l].status="skipped",y[l].message="Cancelled by user";e?.(a,n);break}if(X){y[i].status="skipped",y[i].message="Skipped due to brew lock error",e?.(a,n);continue}let h=y[i];h.status="running",h.startTime=Date.now(),h.currentPhase="starting",e?.(a,n);let $=h.id.startsWith("cask-"),m=h.id.replace(/^(formula|cask)-/,"");try{let l=`upgrade ${$?"--cask":""} ${m}`.trim();await te(l,R=>{h.message=R.message,h.progress=R,h.currentPhase=R.phase,n+=R.message+`
`,e?.(a,n)},t,{staleTimeoutMs:I,packageName:m,verboseLogging:O}),h.status="completed",h.endTime=Date.now(),h.message="Upgraded successfully",k.log("Package upgraded",{identifier:m})}catch(d){if(h.status="failed",h.endTime=Date.now(),h.error=d instanceof Error?d:new Error(String(d)),h.message=H(d),h.isRecoverable=G(d),k.error("Package upgrade failed",{identifier:m,error:h.message,errorType:d instanceof Error?d.name:"unknown",isRecoverable:h.isRecoverable,currentPhase:h.currentPhase}),d instanceof j&&(X=!0,k.warn("Lock error detected, skipping remaining packages")),d instanceof K&&k.warn("Stale process detected",{packageName:m,lastPhase:d.lastPhase,staleDurationMs:d.staleDurationMs}),!g){for(let l=i+1;l<y.length;l++)y[l].status="skipped",y[l].message="Skipped due to previous error";e?.(a,n);break}}e?.(a,n)}let C=a.filter(i=>i.status==="failed"),Q=C.filter(i=>i.isRecoverable),D={success:C.length===0,steps:a,error:C.length>0?new Error(`${C.length} package(s) failed to upgrade`):void 0};return k.log("Batch upgrade completed",{success:D.success,completed:a.filter(i=>i.status==="completed").length,failed:C.length,recoverableFailures:Q.length,skipped:a.filter(i=>i.status==="skipped").length}),D}var pr=require("react"),Z=require("@raycast/api");var me=require("react/jsx-runtime"),Ne=class extends pr.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){fe.error("React error boundary caught error",{error:e.message,stack:e.stack,componentStack:t.componentStack}),this.setState({errorInfo:t})}render(){if(this.state.hasError){if(this.props.fallback)return this.props.fallback;let{error:e,errorInfo:t}=this.state,s=["# An Error Occurred","","Something went wrong while rendering this view.","","## Error Message","```",e?.message??"Unknown error","```","",e?.stack?["## Stack Trace","```",e.stack,"```",""].join(`
`):"",t?.componentStack?["## Component Stack","```",t.componentStack,"```"].join(`
`):""].join(`
`);return(0,me.jsx)(Z.Detail,{markdown:s,actions:(0,me.jsxs)(Z.ActionPanel,{children:[(0,me.jsx)(Z.Action,{title:"Reload",icon:Z.Icon.ArrowClockwise,onAction:()=>this.setState({hasError:!1,error:void 0,errorInfo:void 0})}),(0,me.jsx)(Z.Action.CopyToClipboard,{title:"Copy Error Details",content:s})]})})}return this.props.children}};var x=require("react/jsx-runtime"),Y={UPGRADING:"Upgrading...",NOTHING_TO_UPGRADE:"Nothing to upgrade!",UPGRADE_CANCELLED:"Upgrade Cancelled",UPGRADE_FAILED:"Upgrade Failed"};function As(r){switch(r.status){case"pending":return{source:c.Icon.Circle,tintColor:c.Color.SecondaryText};case"running":return Fe(.5);case"completed":return{source:c.Icon.CheckCircle,tintColor:c.Color.Green};case"failed":return r.isRecoverable?{source:c.Icon.ExclamationMark,tintColor:c.Color.Orange}:{source:c.Icon.XMarkCircle,tintColor:c.Color.Red};case"skipped":return{source:c.Icon.MinusCircle,tintColor:c.Color.SecondaryText}}}function mr(r,e){if(!r)return;let s=(e||Date.now())-r;if(s<1e3)return`${s}ms`;let a=Math.floor(s/1e3);if(a<60)return`${a}s`;let n=Math.floor(a/60),f=a%60;return`${n}m ${f}s`}function Ts(r){return r.length===0?0:r.filter(t=>t.status==="completed"||t.status==="skipped"||t.status==="failed").length/r.length}function Rs(){let[r,e]=(0,T.useState)([]),[t,s]=(0,T.useState)(!0),[a,n]=(0,T.useState)(""),[f,g]=(0,T.useState)(),[I,O]=(0,T.useState)(!1),p=(0,T.useRef)(null),b=(0,T.useRef)(!1),w=(0,T.useRef)(!0),y=(0,T.useCallback)((o,P)=>{w.current&&(e([...o]),P&&n(P),k.log("Upgrade progress",{completedSteps:o.filter(z=>z.status==="completed").length,totalSteps:o.length}))},[]),X=(0,T.useCallback)(async()=>{if(b.current){k.log("Upgrade already started, skipping duplicate call");return}b.current=!0,k.log("Starting upgrade process");let o=new AbortController;p.current=o;let P=await(0,c.showToast)({style:c.Toast.Style.Animated,title:"Upgrading packages..."});try{let z=await lt(v.greedyUpgrades,y,o.signal);if(z.success){let L=z.steps.filter(le=>le.status==="completed").length,ee=z.steps.filter(le=>le.status==="skipped").length;if(L<=2)P.style=c.Toast.Style.Success,P.title=Y.NOTHING_TO_UPGRADE;else{let le=L-2;P.style=c.Toast.Style.Success,P.title=`${le} package${le===1?"":"s"} upgraded.`,ee>0&&(P.title+=` ${ee} skipped.`)}}else P.style=c.Toast.Style.Failure,P.title="Upgrade failed",P.message=z.error?.message,g(z.error)}catch(z){let L=Re(z);k.error("Upgrade caught exception",{name:L.name,message:L.message,stack:L.stack}),L.name==="AbortError"?(P.style=c.Toast.Style.Failure,P.title="Upgrade cancelled",O(!0),k.log("Upgrade cancelled by user",{completedSteps:r.filter(ee=>ee.status==="completed").length,runningStep:r.find(ee=>ee.status==="running")?.title,pendingSteps:r.filter(ee=>ee.status==="pending").length,totalSteps:r.length})):(P.style=c.Toast.Style.Failure,P.title="Upgrade failed",P.message=L.message,g(L),await it("Upgrade failed",L))}finally{s(!1),p.current=null}},[y]);(0,T.useEffect)(()=>(w.current=!0,k.log("UpgradeView mounted"),X(),()=>{k.log("UpgradeView cleanup called"),w.current=!1}),[X]);let C=(0,T.useCallback)(()=>{p.current&&p.current.abort()},[]),Q=Ts(r),D=r.find(o=>o.status==="running"),i=r.filter(o=>o.status==="completed").length,h=r.filter(o=>o.status==="failed").length,$=r.filter(o=>o.status==="failed"&&o.isRecoverable).length,m=r.filter(o=>o.status==="skipped").length,d=r.filter(o=>o.message==="Cancelled by user"||o.message==="Cancelled").length,l=I||d>0,R=Y.UPGRADING;t?D&&(R=`Upgrading ${D.title}...`):l?R=Y.UPGRADE_CANCELLED:f||h>0?R=Y.UPGRADE_FAILED:i<=2?R=Y.NOTHING_TO_UPGRADE:R=`Upgraded ${i-2} package${i-2===1?"":"s"}`;let N=Y.UPGRADING;return t||(l?N=Y.UPGRADE_CANCELLED:f||h>0?N=Y.UPGRADE_FAILED:i<=2?N=Y.NOTHING_TO_UPGRADE:N="Upgrade Complete"),(0,x.jsxs)(c.List,{isLoading:t&&r.length===0,navigationTitle:R,searchBarPlaceholder:N,children:[r.length===0&&t&&(0,x.jsx)(c.List.EmptyView,{icon:Fe(.1),title:"Preparing upgrade...",description:"Checking for outdated packages"}),r.length>0&&(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(c.List.Section,{title:"Progress",subtitle:`${Math.round(Q*100)}% complete`,children:r.map(o=>(0,x.jsx)(c.List.Item,{icon:As(o),title:o.title,subtitle:o.subtitle,accessories:[...o.status==="running"&&o.currentPhase?[{tag:{value:o.currentPhase,color:c.Color.Blue},tooltip:`Current phase: ${o.currentPhase}`}]:[],...o.message?[{text:o.message==="Aborted"?"Cancelled":o.message,tooltip:o.message==="Aborted"?"Cancelled by user":o.message}]:[],...o.status==="failed"&&o.isRecoverable?[{tag:{value:"Retry",color:c.Color.Orange},tooltip:"This error may be resolved by retrying"}]:[],...o.status==="running"||o.status==="completed"||o.status==="failed"?[{text:mr(o.startTime,o.endTime),tooltip:"Duration"}]:[]],actions:(0,x.jsxs)(c.ActionPanel,{children:[t&&(0,x.jsx)(c.Action,{title:"Cancel Upgrade",icon:c.Icon.XMarkCircle,style:c.Action.Style.Destructive,onAction:C}),!t&&(0,x.jsx)(c.Action,{title:"Close",icon:c.Icon.ArrowLeft,onAction:()=>(0,c.popToRoot)()}),a&&(0,x.jsx)(c.Action.CopyToClipboard,{title:"Copy Output Log",content:a,shortcut:{modifiers:["cmd"],key:"l"}})]})},o.id))}),!t&&(0,x.jsxs)(c.List.Section,{title:"Summary",children:[r.filter(o=>o.status==="completed"&&(o.id.startsWith("formula-")||o.id.startsWith("cask-"))).map(o=>(0,x.jsx)(c.List.Item,{icon:{source:c.Icon.CheckCircle,tintColor:c.Color.Green},title:o.title,accessories:[...o.subtitle?[{text:o.subtitle,tooltip:"Version change"}]:[],{text:"Upgraded",tooltip:`Upgraded in ${mr(o.startTime,o.endTime)}`}]},`summary-${o.id}`)),r.filter(o=>o.status==="failed"&&(o.id.startsWith("formula-")||o.id.startsWith("cask-"))).map(o=>(0,x.jsx)(c.List.Item,{icon:{source:c.Icon.XMarkCircle,tintColor:c.Color.Red},title:o.title,accessories:[...o.subtitle?[{text:o.subtitle,tooltip:"Version change"}]:[],{text:o.message||"Failed",tooltip:o.message}]},`summary-${o.id}`)),(i>2||h>0||l)&&(0,x.jsx)(c.List.Item,{icon:{source:l?c.Icon.XMarkCircle:c.Icon.Document,tintColor:l?c.Color.Orange:c.Color.SecondaryText},title:"Total",accessories:[...i>2?[{text:`${i-2} upgraded`,tooltip:"Packages upgraded"}]:[],...l?[{text:d>0?`${d} cancelled`:m>0?`${m} skipped`:"Cancelled",tooltip:"Upgrade was cancelled by user"}]:[],...h>0&&!l?[{text:`${h} failed${$>0?` (${$} retryable)`:""}`,tooltip:$>0?"Some failures may be resolved by retrying":"Packages failed"}]:[]]}),i<=2&&h===0&&!l&&(0,x.jsx)(c.List.Item,{icon:{source:c.Icon.CheckCircle,tintColor:c.Color.Green},title:"All packages are up to date"})]})]})]})}function gr(){return(0,x.jsx)(Ne,{children:(0,x.jsx)(Rs,{})})}
