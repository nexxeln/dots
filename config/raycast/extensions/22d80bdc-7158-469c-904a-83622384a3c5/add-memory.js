"use strict";var oe=Object.create;var _=Object.defineProperty;var ce=Object.getOwnPropertyDescriptor;var le=Object.getOwnPropertyNames;var ue=Object.getPrototypeOf,fe=Object.prototype.hasOwnProperty;var de=(e,t)=>{for(var r in t)_(e,r,{get:t[r],enumerable:!0})},G=(e,t,r,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of le(t))!fe.call(e,n)&&n!==r&&_(e,n,{get:()=>t[n],enumerable:!(s=ce(t,n))||s.enumerable});return e};var V=(e,t,r)=>(r=e!=null?oe(ue(e)):{},G(t||!e||!e.__esModule?_(r,"default",{value:e,enumerable:!0}):r,e)),he=e=>G(_({},"__esModule",{value:!0}),e);var ke={};de(ke,{default:()=>$e});module.exports=he(ke);var l=require("@raycast/api"),Q=require("react");var m=require("@raycast/api"),pe="https://api.supermemory.ai",P=class extends Error{constructor(r,s){super(r);this.status=s;this.name="SupermemoryAPIError"}},U=class extends Error{constructor(t){super(t),this.name="AuthenticationError"}};function me(){let{apiKey:e}=(0,m.getPreferenceValues)();return e}async function W(e,t={}){let r=me(),s=`${pe}${e}`;try{let n=await fetch(s,{...t,headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json",...t.headers}});if(!n.ok){if(n.status===401)throw new U("Invalid API key. Please check your API key in preferences. Get a new one from https://supermemory.link/raycast");let c=`API request failed: ${n.statusText}`;try{let h=await n.json();h.message&&(c=h.message)}catch{}throw new P(c,n.status)}if(!n.headers.get("content-type")?.includes("application/json"))throw new P("Invalid response format from API");return await n.json()}catch(n){throw n instanceof U||n instanceof P?n:new P(`Network error: ${n instanceof Error?n.message:"Unknown error"}`)}}async function K(){try{return(await W("/v3/projects")).projects||[]}catch(e){throw await(0,m.showToast)({style:m.Toast.Style.Failure,title:"Failed to fetch projects",message:e instanceof Error?e.message:"Unknown error occurred"}),e}}async function J(e){try{let t=await W("/v3/documents",{method:"POST",body:JSON.stringify(e)});return await(0,m.showToast)({style:m.Toast.Style.Success,title:"Memory Added",message:"Successfully added memory to Supermemory"}),t}catch(t){throw await(0,m.showToast)({style:m.Toast.Style.Failure,title:"Failed to add memory",message:t instanceof Error?t.message:"Unknown error occurred"}),t}}async function H(){return await W("/v3/settings")}var o=V(require("react")),i=require("@raycast/api");var q=Object.prototype.hasOwnProperty;function I(e,t){var r,s;if(e===t)return!0;if(e&&t&&(r=e.constructor)===t.constructor){if(r===Date)return e.getTime()===t.getTime();if(r===RegExp)return e.toString()===t.toString();if(r===Array){if((s=e.length)===t.length)for(;s--&&I(e[s],t[s]););return s===-1}if(!r||typeof e=="object"){s=0;for(r in e)if(q.call(e,r)&&++s&&!q.call(t,r)||!(r in t)||!I(e[r],t[r]))return!1;return Object.keys(t).length===s}}return e!==e&&t!==t}var x=V(require("node:fs")),C=V(require("node:path"));var Y=require("react/jsx-runtime");function ge(e){let t=(0,o.useRef)(e),r=(0,o.useRef)(0);return I(e,t.current)||(t.current=e,r.current+=1),(0,o.useMemo)(()=>t.current,[r.current])}function y(e){let t=(0,o.useRef)(e);return t.current=e,t}function be(e,t){let r=e instanceof Error?e.message:String(e);return(0,i.showToast)({style:i.Toast.Style.Failure,title:t?.title??"Something went wrong",message:t?.message??r,primaryAction:t?.primaryAction??Z(e),secondaryAction:t?.primaryAction?Z(e):void 0})}var Z=e=>{let t=!0,r="[Extension Name]...",s="";try{let c=JSON.parse((0,x.readFileSync)((0,C.join)(i.environment.assetsPath,"..","package.json"),"utf8"));r=`[${c.title}]...`,s=`https://raycast.com/${c.owner||c.author}/${c.name}`,(!c.owner||c.access==="public")&&(t=!1)}catch{}let n=i.environment.isDevelopment||t,u=e instanceof Error?e?.stack||e?.message||"":String(e);return{title:n?"Copy Logs":"Report Error",onAction(c){c.hide(),n?i.Clipboard.copy(u):(0,i.open)(`https://github.com/raycast/extensions/issues/new?&labels=extension%2Cbug&template=extension_bug_report.yml&title=${encodeURIComponent(r)}&extension-url=${encodeURI(s)}&description=${encodeURIComponent(`#### Error:
\`\`\`
${u}
\`\`\`
`)}`)}}};function O(e,t,r){let s=(0,o.useRef)(0),[n,u]=(0,o.useState)({isLoading:!0}),c=y(e),h=y(r?.abortable),S=y(t||[]),M=y(r?.onError),R=y(r?.onData),z=y(r?.onWillExecute),N=y(r?.failureToastOptions),F=y(n.data),L=(0,o.useRef)(null),p=(0,o.useRef)({page:0}),j=(0,o.useRef)(!1),D=(0,o.useRef)(!0),B=(0,o.useRef)(50),$=(0,o.useCallback)(()=>(h.current&&(h.current.current?.abort(),h.current.current=new AbortController),++s.current),[h]),w=(0,o.useCallback)((...b)=>{let d=$();z.current?.(b),u(a=>({...a,isLoading:!0}));let E=ye(c.current)(...b);function A(a){return a.name=="AbortError"||d===s.current&&(M.current?M.current(a):i.environment.launchType!==i.LaunchType.Background&&be(a,{title:"Failed to fetch latest data",primaryAction:{title:"Retry",onAction(k){k.hide(),L.current?.(...S.current||[])}},...N.current}),u({error:a,isLoading:!1})),a}return typeof E=="function"?(j.current=!0,E(p.current).then(({data:a,hasMore:k,cursor:se})=>(d===s.current&&(p.current&&(p.current.cursor=se,p.current.lastItem=a?.[a.length-1]),R.current&&R.current(a,p.current),k&&(B.current=a.length),D.current=k,u(ie=>p.current.page===0?{data:a,isLoading:!1}:{data:(ie.data||[])?.concat(a),isLoading:!1})),a),a=>(D.current=!1,A(a)))):(j.current=!1,E.then(a=>(d===s.current&&(R.current&&R.current(a),u({data:a,isLoading:!1})),a),A))},[R,M,S,c,u,L,z,p,N,$]);L.current=w;let T=(0,o.useCallback)(()=>{p.current={page:0};let b=S.current||[];return w(...b)},[w,S]),ee=(0,o.useCallback)(async(b,d)=>{let E;try{if(d?.optimisticUpdate){$(),typeof d?.rollbackOnError!="function"&&d?.rollbackOnError!==!1&&(E=structuredClone(F.current?.value));let A=d.optimisticUpdate;u(a=>({...a,data:A(a.data)}))}return await b}catch(A){if(typeof d?.rollbackOnError=="function"){let a=d.rollbackOnError;u(k=>({...k,data:a(k.data)}))}else d?.optimisticUpdate&&d?.rollbackOnError!==!1&&u(a=>({...a,data:E}));throw A}finally{d?.shouldRevalidateAfter!==!1&&(i.environment.launchType===i.LaunchType.Background||i.environment.commandMode==="menu-bar"?await T():T())}},[T,F,u,$]),te=(0,o.useCallback)(()=>{p.current.page+=1;let b=S.current||[];w(...b)},[p,S,w]);(0,o.useEffect)(()=>{p.current={page:0},r?.execute!==!1?w(...t||[]):$()},[ge([t,r?.execute,w]),h,p]),(0,o.useEffect)(()=>()=>{$()},[$]);let re=r?.execute!==!1?n.isLoading:!1,ne={...n,isLoading:re},ae=j.current?{pageSize:B.current,hasMore:D.current,onLoadMore:te}:void 0;return{...ne,revalidate:T,mutate:ee,pagination:ae}}function ye(e){return e===Promise.all||e===Promise.race||e===Promise.resolve||e===Promise.reject?e.bind(Promise):e}var f=require("@raycast/api"),v=require("react/jsx-runtime");function X(e){return function(r){let{isLoading:s,data:n}=O(H,[],{failureToastOptions:{title:"Invalid API Key",message:"Invalid API key. Please check your API key in preferences. Get a new one from https://supermemory.link/raycast"}});return n?(0,v.jsx)(e,{...r}):s?(0,v.jsx)(f.Detail,{isLoading:!0}):(0,v.jsx)(f.List,{children:(0,v.jsx)(f.List.EmptyView,{icon:f.Icon.ExclamationMark,title:"API Key Required",description:"Please configure your Supermemory API key to search memories",actions:(0,v.jsx)(f.ActionPanel,{children:(0,v.jsx)(f.Action,{title:"Open Extension Preferences",onAction:f.openExtensionPreferences,icon:f.Icon.Gear})})})})}}var g=require("react/jsx-runtime"),$e=X(we);function we(){let[e,t]=(0,Q.useState)(!1),{pop:r}=(0,l.useNavigation)(),{isLoading:s,data:n=[]}=O(K);async function u(c){if(!c.content.trim()){await(0,l.showToast)({style:l.Toast.Style.Failure,title:"Content Required",message:"Please enter some content for the memory"});return}try{t(!0);let h=c.project?[c.project]:void 0;await J({content:c.content.trim(),containerTags:h}),r()}catch(h){console.error("Failed to add memory:",h)}finally{t(!1)}}return(0,g.jsxs)(l.Form,{isLoading:s||e,actions:!s&&(0,g.jsx)(l.ActionPanel,{children:(0,g.jsx)(l.Action.SubmitForm,{icon:l.Icon.Plus,title:"Add Memory",onSubmit:u})}),children:[(0,g.jsx)(l.Form.TextArea,{id:"content",title:"Content",placeholder:"Enter the memory content...",info:"The main content of your memory. This is required."}),(0,g.jsx)(l.Form.Separator,{}),(0,g.jsxs)(l.Form.Dropdown,{id:"project",title:"Project",info:"Select a project to organize this memory",storeValue:!0,children:[(0,g.jsx)(l.Form.Dropdown.Item,{value:"",title:"No Project"}),n.map(c=>(0,g.jsx)(l.Form.Dropdown.Item,{value:c.containerTag,title:c.name},c.id))]})]})}
