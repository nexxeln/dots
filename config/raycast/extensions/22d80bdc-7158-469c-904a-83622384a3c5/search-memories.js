"use strict";var ce=Object.create;var _=Object.defineProperty;var le=Object.getOwnPropertyDescriptor;var ue=Object.getOwnPropertyNames;var fe=Object.getPrototypeOf,de=Object.prototype.hasOwnProperty;var he=(e,t)=>{for(var r in t)_(e,r,{get:t[r],enumerable:!0})},B=(e,t,r,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of ue(t))!de.call(e,n)&&n!==r&&_(e,n,{get:()=>t[n],enumerable:!(a=le(t,n))||a.enumerable});return e};var V=(e,t,r)=>(r=e!=null?ce(fe(e)):{},B(t||!e||!e.__esModule?_(r,"default",{value:e,enumerable:!0}):r,e)),pe=e=>B(_({},"__esModule",{value:!0}),e);var ve={};he(ve,{default:()=>we});module.exports=pe(ve);var i=require("@raycast/api"),X=require("react");var R=require("@raycast/api"),me="https://api.supermemory.ai",P=class extends Error{constructor(r,a){super(r);this.status=a;this.name="SupermemoryAPIError"}},C=class extends Error{constructor(t){super(t),this.name="AuthenticationError"}};function ge(){let{apiKey:e}=(0,R.getPreferenceValues)();return e}async function G(e,t={}){let r=ge(),a=`${me}${e}`;try{let n=await fetch(a,{...t,headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json",...t.headers}});if(!n.ok){if(n.status===401)throw new C("Invalid API key. Please check your API key in preferences. Get a new one from https://supermemory.link/raycast");let u=`API request failed: ${n.statusText}`;try{let c=await n.json();c.message&&(u=c.message)}catch{}throw new P(u,n.status)}if(!n.headers.get("content-type")?.includes("application/json"))throw new P("Invalid response format from API");return await n.json()}catch(n){throw n instanceof C||n instanceof P?n:new P(`Network error: ${n instanceof Error?n.message:"Unknown error"}`)}}async function K(e){try{return(await G("/v3/search",{method:"POST",body:JSON.stringify(e)})).results||[]}catch(t){throw await(0,R.showToast)({style:R.Toast.Style.Failure,title:"Failed to search memories",message:t instanceof Error?t.message:"Unknown error occurred"}),t}}async function J(){return await G("/v3/settings")}var l=V(require("react")),o=require("@raycast/api");var H=Object.prototype.hasOwnProperty;function I(e,t){var r,a;if(e===t)return!0;if(e&&t&&(r=e.constructor)===t.constructor){if(r===Date)return e.getTime()===t.getTime();if(r===RegExp)return e.toString()===t.toString();if(r===Array){if((a=e.length)===t.length)for(;a--&&I(e[a],t[a]););return a===-1}if(!r||typeof e=="object"){a=0;for(r in e)if(H.call(e,r)&&++a&&!H.call(t,r)||!(r in t)||!I(e[r],t[r]))return!1;return Object.keys(t).length===a}}return e!==e&&t!==t}var v=V(require("node:fs")),O=V(require("node:path"));var Z=require("react/jsx-runtime");function be(e){let t=(0,l.useRef)(e),r=(0,l.useRef)(0);return I(e,t.current)||(t.current=e,r.current+=1),(0,l.useMemo)(()=>t.current,[r.current])}function $(e){let t=(0,l.useRef)(e);return t.current=e,t}function ye(e,t){let r=e instanceof Error?e.message:String(e);return(0,o.showToast)({style:o.Toast.Style.Failure,title:t?.title??"Something went wrong",message:t?.message??r,primaryAction:t?.primaryAction??q(e),secondaryAction:t?.primaryAction?q(e):void 0})}var q=e=>{let t=!0,r="[Extension Name]...",a="";try{let u=JSON.parse((0,v.readFileSync)((0,O.join)(o.environment.assetsPath,"..","package.json"),"utf8"));r=`[${u.title}]...`,a=`https://raycast.com/${u.owner||u.author}/${u.name}`,(!u.owner||u.access==="public")&&(t=!1)}catch{}let n=o.environment.isDevelopment||t,h=e instanceof Error?e?.stack||e?.message||"":String(e);return{title:n?"Copy Logs":"Report Error",onAction(u){u.hide(),n?o.Clipboard.copy(h):(0,o.open)(`https://github.com/raycast/extensions/issues/new?&labels=extension%2Cbug&template=extension_bug_report.yml&title=${encodeURIComponent(r)}&extension-url=${encodeURI(a)}&description=${encodeURIComponent(`#### Error:
\`\`\`
${h}
\`\`\`
`)}`)}}};function M(e,t,r){let a=(0,l.useRef)(0),[n,h]=(0,l.useState)({isLoading:!0}),u=$(e),c=$(r?.abortable),f=$(t||[]),b=$(r?.onError),T=$(r?.onData),W=$(r?.onWillExecute),z=$(r?.failureToastOptions),N=$(n.data),L=(0,l.useRef)(null),g=(0,l.useRef)({page:0}),D=(0,l.useRef)(!1),j=(0,l.useRef)(!0),F=(0,l.useRef)(50),w=(0,l.useCallback)(()=>(c.current&&(c.current.current?.abort(),c.current.current=new AbortController),++a.current),[c]),k=(0,l.useCallback)((...y)=>{let m=w();W.current?.(y),h(s=>({...s,isLoading:!0}));let E=$e(u.current)(...y);function A(s){return s.name=="AbortError"||m===a.current&&(b.current?b.current(s):o.environment.launchType!==o.LaunchType.Background&&ye(s,{title:"Failed to fetch latest data",primaryAction:{title:"Retry",onAction(x){x.hide(),L.current?.(...f.current||[])}},...z.current}),h({error:s,isLoading:!1})),s}return typeof E=="function"?(D.current=!0,E(g.current).then(({data:s,hasMore:x,cursor:ie})=>(m===a.current&&(g.current&&(g.current.cursor=ie,g.current.lastItem=s?.[s.length-1]),T.current&&T.current(s,g.current),x&&(F.current=s.length),j.current=x,h(oe=>g.current.page===0?{data:s,isLoading:!1}:{data:(oe.data||[])?.concat(s),isLoading:!1})),s),s=>(j.current=!1,A(s)))):(D.current=!1,E.then(s=>(m===a.current&&(T.current&&T.current(s),h({data:s,isLoading:!1})),s),A))},[T,b,f,u,h,L,W,g,z,w]);L.current=k;let U=(0,l.useCallback)(()=>{g.current={page:0};let y=f.current||[];return k(...y)},[k,f]),te=(0,l.useCallback)(async(y,m)=>{let E;try{if(m?.optimisticUpdate){w(),typeof m?.rollbackOnError!="function"&&m?.rollbackOnError!==!1&&(E=structuredClone(N.current?.value));let A=m.optimisticUpdate;h(s=>({...s,data:A(s.data)}))}return await y}catch(A){if(typeof m?.rollbackOnError=="function"){let s=m.rollbackOnError;h(x=>({...x,data:s(x.data)}))}else m?.optimisticUpdate&&m?.rollbackOnError!==!1&&h(s=>({...s,data:E}));throw A}finally{m?.shouldRevalidateAfter!==!1&&(o.environment.launchType===o.LaunchType.Background||o.environment.commandMode==="menu-bar"?await U():U())}},[U,N,h,w]),re=(0,l.useCallback)(()=>{g.current.page+=1;let y=f.current||[];k(...y)},[g,f,k]);(0,l.useEffect)(()=>{g.current={page:0},r?.execute!==!1?k(...t||[]):w()},[be([t,r?.execute,k]),c,g]),(0,l.useEffect)(()=>()=>{w()},[w]);let ne=r?.execute!==!1?n.isLoading:!1,ae={...n,isLoading:ne},se=D.current?{pageSize:F.current,hasMore:j.current,onLoadMore:re}:void 0;return{...ae,revalidate:U,mutate:te,pagination:se}}function $e(e){return e===Promise.all||e===Promise.race||e===Promise.resolve||e===Promise.reject?e.bind(Promise):e}var p=require("@raycast/api"),S=require("react/jsx-runtime");function Y(e){return function(r){let{isLoading:a,data:n}=M(J,[],{failureToastOptions:{title:"Invalid API Key",message:"Invalid API key. Please check your API key in preferences. Get a new one from https://supermemory.link/raycast"}});return n?(0,S.jsx)(e,{...r}):a?(0,S.jsx)(p.Detail,{isLoading:!0}):(0,S.jsx)(p.List,{children:(0,S.jsx)(p.List.EmptyView,{icon:p.Icon.ExclamationMark,title:"API Key Required",description:"Please configure your Supermemory API key to search memories",actions:(0,S.jsx)(p.ActionPanel,{children:(0,S.jsx)(p.Action,{title:"Open Extension Preferences",onAction:p.openExtensionPreferences,icon:p.Icon.Gear})})})})}}var d=require("react/jsx-runtime"),Q=e=>e.chunks&&e.chunks.length>0?e.chunks.map(t=>typeof t=="string"?t:t&&typeof t=="object"&&"content"in t&&typeof t.content=="string"?t.content:t&&typeof t=="object"&&"text"in t&&typeof t.text=="string"?t.text:"").filter(Boolean).join(" "):"No content available",ee=e=>e.metadata?.url&&typeof e.metadata.url=="string"?e.metadata.url:null,we=Y(ke);function ke(){let[e,t]=(0,X.useState)(""),{isLoading:r,data:a=[]}=M(async c=>{let f=c.trim();if(!f)return[];let b=await K({q:f,limit:50});return b.length||await(0,i.showToast)({style:i.Toast.Style.Success,title:"Search Complete",message:"No memories found for your query"}),b},[e]),n=c=>{try{return new Date(c).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return"Unknown date"}},h=(c,f=100)=>c.length<=f?c:`${c.substring(0,f)}...`,u=!r&&!a.length;return(0,d.jsx)(i.List,{isLoading:r,onSearchTextChange:t,searchBarPlaceholder:"Search your memories...",throttle:!0,children:u&&!e.trim()?(0,d.jsx)(i.List.EmptyView,{icon:i.Icon.MagnifyingGlass,title:"Search Your Memories",description:"Type to search through your Supermemory collection"}):u?(0,d.jsx)(i.List.EmptyView,{icon:i.Icon.Document,title:"No Memories Found",description:`No memories found for "${e}"`}):r&&e.trim()?(0,d.jsx)(i.List.EmptyView,{icon:i.Icon.MagnifyingGlass,title:"Searching Your Memories"}):a.map(c=>{let f=Q(c),b=ee(c);return(0,d.jsx)(i.List.Item,{icon:b?i.Icon.Link:i.Icon.Document,title:c.title||"Untitled Memory",subtitle:{value:h(f),tooltip:f},accessories:[{text:n(c.createdAt)},...c.score?[{text:`${Math.round(c.score*100)}%`}]:[]],actions:(0,d.jsxs)(i.ActionPanel,{children:[(0,d.jsx)(i.Action.Push,{title:"View Details",target:(0,d.jsx)(xe,{memory:c}),icon:i.Icon.Eye}),(0,d.jsx)(i.Action.CopyToClipboard,{title:"Copy Content",shortcut:{modifiers:["cmd"],key:"c"},content:f}),b&&(0,d.jsx)(i.Action.OpenInBrowser,{title:"Open URL",url:b,shortcut:{modifiers:["cmd"],key:"o"}})]})},c.documentId)})})}function xe({memory:e}){let t=Q(e),r=ee(e),a=`
# ${e.title||"Untitled Memory"}

${t}

---

**Created:** ${new Date(e.createdAt).toLocaleString()}
${r?`**URL:** ${r}`:""}
${e.score?`**Relevance:** ${Math.round(e.score*100)}%`:""}
`;return(0,d.jsx)(i.Detail,{markdown:a,actions:(0,d.jsxs)(i.ActionPanel,{children:[(0,d.jsx)(i.Action.CopyToClipboard,{title:"Copy Content",shortcut:{modifiers:["cmd"],key:"c"},content:t}),r&&(0,d.jsx)(i.Action.OpenInBrowser,{title:"Open URL",url:r,shortcut:{modifiers:["cmd"],key:"o"}})]})})}
