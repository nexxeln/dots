"use strict";var $e=Object.create;var V=Object.defineProperty;var we=Object.getOwnPropertyDescriptor;var ke=Object.getOwnPropertyNames;var xe=Object.getPrototypeOf,ve=Object.prototype.hasOwnProperty;var Se=(r,n)=>{for(var e in n)V(r,e,{get:n[e],enumerable:!0})},Z=(r,n,e,t)=>{if(n&&typeof n=="object"||typeof n=="function")for(let a of ke(n))!ve.call(r,a)&&a!==e&&V(r,a,{get:()=>n[a],enumerable:!(t=we(n,a))||t.enumerable});return r};var N=(r,n,e)=>(e=r!=null?$e(xe(r)):{},Z(n||!r||!r.__esModule?V(e,"default",{value:r,enumerable:!0}):e,r)),Ee=r=>Z(V({},"__esModule",{value:!0}),r);var De={};Se(De,{default:()=>je});module.exports=Ee(De);var $=require("@raycast/api"),he=require("react");var C=require("@raycast/api"),Pe="https://api.supermemory.ai",D=class extends Error{constructor(e,t){super(e);this.status=t;this.name="SupermemoryAPIError"}},F=class extends Error{constructor(n){super(n),this.name="AuthenticationError"}};function Ae(){let{apiKey:r}=(0,C.getPreferenceValues)();return r}async function K(r,n={}){let e=Ae(),t=`${Pe}${r}`;try{let a=await fetch(t,{...n,headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json",...n.headers}});if(!a.ok){if(a.status===401)throw new F("Invalid API key. Please check your API key in preferences. Get a new one from https://supermemory.link/raycast");let s=`API request failed: ${a.statusText}`;try{let c=await a.json();c.message&&(s=c.message)}catch{}throw new D(s,a.status)}if(!a.headers.get("content-type")?.includes("application/json"))throw new D("Invalid response format from API");return await a.json()}catch(a){throw a instanceof F||a instanceof D?a:new D(`Network error: ${a instanceof Error?a.message:"Unknown error"}`)}}async function Y(){try{return(await K("/v3/projects")).projects||[]}catch(r){throw await(0,C.showToast)({style:C.Toast.Style.Failure,title:"Failed to fetch projects",message:r instanceof Error?r.message:"Unknown error occurred"}),r}}async function X(r){let n=await K("/v3/projects",{method:"POST",body:JSON.stringify(r)});return await(0,C.showToast)({style:C.Toast.Style.Success,title:"Project Added",message:"Successfully added project to Supermemory"}),n}async function Q(){return await K("/v3/settings")}var i=N(require("react")),h=require("@raycast/api");var ee=Object.prototype.hasOwnProperty;function B(r,n){var e,t;if(r===n)return!0;if(r&&n&&(e=r.constructor)===n.constructor){if(e===Date)return r.getTime()===n.getTime();if(e===RegExp)return r.toString()===n.toString();if(e===Array){if((t=r.length)===n.length)for(;t--&&B(r[t],n[t]););return t===-1}if(!e||typeof r=="object"){t=0;for(e in r)if(ee.call(r,e)&&++t&&!ee.call(n,e)||!(e in n)||!B(r[e],n[e]))return!1;return Object.keys(n).length===t}}return r!==r&&n!==n}var O=N(require("node:fs")),G=N(require("node:path")),se=N(require("node:crypto"));var ie=require("react/jsx-runtime");function Re(r){let n=(0,i.useRef)(r),e=(0,i.useRef)(0);return B(r,n.current)||(n.current=r,e.current+=1),(0,i.useMemo)(()=>n.current,[e.current])}function x(r){let n=(0,i.useRef)(r);return n.current=r,n}function H(r,n){let e=r instanceof Error?r.message:String(r);return(0,h.showToast)({style:h.Toast.Style.Failure,title:n?.title??"Something went wrong",message:n?.message??e,primaryAction:n?.primaryAction??te(r),secondaryAction:n?.primaryAction?te(r):void 0})}var te=r=>{let n=!0,e="[Extension Name]...",t="";try{let s=JSON.parse((0,O.readFileSync)((0,G.join)(h.environment.assetsPath,"..","package.json"),"utf8"));e=`[${s.title}]...`,t=`https://raycast.com/${s.owner||s.author}/${s.name}`,(!s.owner||s.access==="public")&&(n=!1)}catch{}let a=h.environment.isDevelopment||n,l=r instanceof Error?r?.stack||r?.message||"":String(r);return{title:a?"Copy Logs":"Report Error",onAction(s){s.hide(),a?h.Clipboard.copy(l):(0,h.open)(`https://github.com/raycast/extensions/issues/new?&labels=extension%2Cbug&template=extension_bug_report.yml&title=${encodeURIComponent(e)}&extension-url=${encodeURI(t)}&description=${encodeURIComponent(`#### Error:
\`\`\`
${l}
\`\`\`
`)}`)}}};function q(r,n,e){let t=(0,i.useRef)(0),[a,l]=(0,i.useState)({isLoading:!0}),s=x(r),c=x(e?.abortable),o=x(n||[]),g=x(e?.onError),m=x(e?.onData),w=x(e?.onWillExecute),T=x(e?.failureToastOptions),_=x(a.data),E=(0,i.useRef)(null),b=(0,i.useRef)({page:0}),P=(0,i.useRef)(!1),y=(0,i.useRef)(!0),d=(0,i.useRef)(50),p=(0,i.useCallback)(()=>(c.current&&(c.current.current?.abort(),c.current.current=new AbortController),++t.current),[c]),u=(0,i.useCallback)((...U)=>{let R=p();w.current?.(U),l(f=>({...f,isLoading:!0}));let j=Te(s.current)(...U);function M(f){return f.name=="AbortError"||R===t.current&&(g.current?g.current(f):h.environment.launchType!==h.LaunchType.Background&&H(f,{title:"Failed to fetch latest data",primaryAction:{title:"Retry",onAction(I){I.hide(),E.current?.(...o.current||[])}},...T.current}),l({error:f,isLoading:!1})),f}return typeof j=="function"?(P.current=!0,j(b.current).then(({data:f,hasMore:I,cursor:be})=>(R===t.current&&(b.current&&(b.current.cursor=be,b.current.lastItem=f?.[f.length-1]),m.current&&m.current(f,b.current),I&&(d.current=f.length),y.current=I,l(ye=>b.current.page===0?{data:f,isLoading:!1}:{data:(ye.data||[])?.concat(f),isLoading:!1})),f),f=>(y.current=!1,M(f)))):(P.current=!1,j.then(f=>(R===t.current&&(m.current&&m.current(f),l({data:f,isLoading:!1})),f),M))},[m,g,o,s,l,E,w,b,T,p]);E.current=u;let k=(0,i.useCallback)(()=>{b.current={page:0};let U=o.current||[];return u(...U)},[u,o]),A=(0,i.useCallback)(async(U,R)=>{let j;try{if(R?.optimisticUpdate){p(),typeof R?.rollbackOnError!="function"&&R?.rollbackOnError!==!1&&(j=structuredClone(_.current?.value));let M=R.optimisticUpdate;l(f=>({...f,data:M(f.data)}))}return await U}catch(M){if(typeof R?.rollbackOnError=="function"){let f=R.rollbackOnError;l(I=>({...I,data:f(I.data)}))}else R?.optimisticUpdate&&R?.rollbackOnError!==!1&&l(f=>({...f,data:j}));throw M}finally{R?.shouldRevalidateAfter!==!1&&(h.environment.launchType===h.LaunchType.Background||h.environment.commandMode==="menu-bar"?await k():k())}},[k,_,l,p]),z=(0,i.useCallback)(()=>{b.current.page+=1;let U=o.current||[];u(...U)},[b,o,u]);(0,i.useEffect)(()=>{b.current={page:0},e?.execute!==!1?u(...n||[]):p()},[Re([n,e?.execute,u]),c,b]),(0,i.useEffect)(()=>()=>{p()},[p]);let pe=e?.execute!==!1?a.isLoading:!1,me={...a,isLoading:pe},ge=P.current?{pageSize:d.current,hasMore:y.current,onLoadMore:z}:void 0;return{...me,revalidate:k,mutate:A,pagination:ge}}function Te(r){return r===Promise.all||r===Promise.race||r===Promise.resolve||r===Promise.reject?r.bind(Promise):r}function re(r){return typeof r!="function"?!1:/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(r))!==null}function _e(r){return r instanceof URLSearchParams?r.toString():r}function oe(r,n=[]){function e(t){return"update"in r?r.update(t,"utf8"):r.write(t)}return{dispatch:function(t){t=_e(t),t===null?this._null():this["_"+typeof t](t)},_object:function(t){let a=/\[object (.*)\]/i,l=Object.prototype.toString.call(t),s=a.exec(l)?.[1]??"unknown:["+l+"]";s=s.toLowerCase();let c=null;if((c=n.indexOf(t))>=0){this.dispatch("[CIRCULAR:"+c+"]");return}else n.push(t);if(Buffer.isBuffer(t))return e("buffer:"),e(t.toString("utf8"));if(s!=="object"&&s!=="function"&&s!=="asyncfunction")if(this["_"+s])this["_"+s](t);else throw new Error('Unknown object type "'+s+'"');else{let o=Object.keys(t);o=o.sort(),re(t)||o.splice(0,0,"prototype","__proto__","constructor"),e("object:"+o.length+":");let g=this;return o.forEach(function(m){g.dispatch(m),e(":"),g.dispatch(t[m]),e(",")})}},_array:function(t,a){a=typeof a<"u"?a:!1;let l=this;if(e("array:"+t.length+":"),!a||t.length<=1){t.forEach(function(o){l.dispatch(o)});return}let s=[],c=t.map(function(o){let g=Ue(),m=n.slice();return oe(g,m).dispatch(o),s=s.concat(m.slice(n.length)),g.read().toString()});n=n.concat(s),c.sort(),this._array(c,!1)},_date:function(t){e("date:"+t.toJSON())},_symbol:function(t){e("symbol:"+t.toString())},_error:function(t){e("error:"+t.toString())},_boolean:function(t){e("bool:"+t.toString())},_string:function(t){e("string:"+t.length+":"),e(t.toString())},_function:function(t){e("fn:"),re(t)?this.dispatch("[native]"):this.dispatch(t.toString()),this.dispatch("function-name:"+String(t.name)),this._object(t)},_number:function(t){e("number:"+t.toString())},_xml:function(t){e("xml:"+t.toString())},_null:function(){e("Null")},_undefined:function(){e("Undefined")},_regexp:function(t){e("regex:"+t.toString())},_uint8array:function(t){e("uint8array:"),this.dispatch(Array.prototype.slice.call(t))},_uint8clampedarray:function(t){e("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(t))},_int8array:function(t){e("int8array:"),this.dispatch(Array.prototype.slice.call(t))},_uint16array:function(t){e("uint16array:"),this.dispatch(Array.prototype.slice.call(t))},_int16array:function(t){e("int16array:"),this.dispatch(Array.prototype.slice.call(t))},_uint32array:function(t){e("uint32array:"),this.dispatch(Array.prototype.slice.call(t))},_int32array:function(t){e("int32array:"),this.dispatch(Array.prototype.slice.call(t))},_float32array:function(t){e("float32array:"),this.dispatch(Array.prototype.slice.call(t))},_float64array:function(t){e("float64array:"),this.dispatch(Array.prototype.slice.call(t))},_arraybuffer:function(t){e("arraybuffer:"),this.dispatch(new Uint8Array(t))},_url:function(t){e("url:"+t.toString())},_map:function(t){e("map:");let a=Array.from(t);this._array(a,!0)},_set:function(t){e("set:");let a=Array.from(t);this._array(a,!0)},_file:function(t){e("file:"),this.dispatch([t.name,t.size,t.type,t.lastModified])},_blob:function(){throw Error(`Hashing Blob objects is currently not supported
(see https://github.com/puleos/object-hash/issues/26)
Use "options.replacer" or "options.ignoreUnknown"
`)},_domwindow:function(){e("domwindow")},_bigint:function(t){e("bigint:"+t.toString())},_process:function(){e("process")},_timer:function(){e("timer")},_pipe:function(){e("pipe")},_tcp:function(){e("tcp")},_udp:function(){e("udp")},_tty:function(){e("tty")},_statwatcher:function(){e("statwatcher")},_securecontext:function(){e("securecontext")},_connection:function(){e("connection")},_zlib:function(){e("zlib")},_context:function(){e("context")},_nodescript:function(){e("nodescript")},_httpparser:function(){e("httpparser")},_dataview:function(){e("dataview")},_signal:function(){e("signal")},_fsevent:function(){e("fsevent")},_tlswrap:function(){e("tlswrap")}}}function Ue(){return{buf:"",write:function(r){this.buf+=r},end:function(r){this.buf+=r},read:function(){return this.buf}}}function Ce(r,n){let e=this[r];return e instanceof Date?`__raycast_cached_date__${e.toString()}`:Buffer.isBuffer(e)?`__raycast_cached_buffer__${e.toString("base64")}`:n}function Ie(r,n){return typeof n=="string"&&n.startsWith("__raycast_cached_date__")?new Date(n.replace("__raycast_cached_date__","")):typeof n=="string"&&n.startsWith("__raycast_cached_buffer__")?Buffer.from(n.replace("__raycast_cached_buffer__",""),"base64"):n}function ne(r){let n=se.default.createHash("sha1");return oe(n).dispatch(r),n.digest("hex")}var Oe=Symbol("cache without namespace"),ae=new Map;function Le(r,n,e){let t=e?.cacheNamespace||Oe,a=ae.get(t)||ae.set(t,new h.Cache({namespace:e?.cacheNamespace})).get(t);if(!a)throw new Error("Missing cache");let l=x(r),s=x(n),c=(0,i.useSyncExternalStore)(a.subscribe,()=>{try{return a.get(l.current)}catch(w){console.error("Could not get Cache data:",w);return}}),o=(0,i.useMemo)(()=>{if(typeof c<"u"){if(c==="undefined")return;try{return JSON.parse(c,Ie)}catch(w){return console.warn("The cached data is corrupted",w),s.current}}else return s.current},[c,s]),g=x(o),m=(0,i.useCallback)(w=>{let T=typeof w=="function"?w(g.current):w;if(typeof T>"u")a.set(l.current,"undefined");else{let _=JSON.stringify(T,Ce);a.set(l.current,_)}return T},[a,l,g]);return[o,m]}var W=Symbol();function ce(r,n,e){let{initialData:t,keepPreviousData:a,internal_cacheKeySuffix:l,...s}=e||{},c=(0,i.useRef)(null),[o,g]=Le(ne(n||[])+l,W,{cacheNamespace:ne(r)}),m=(0,i.useRef)(o!==W?o:t),w=(0,i.useRef)(void 0),{mutate:T,revalidate:_,...E}=q(r,n||[],{...s,onData(p,u){w.current=u,s.onData&&s.onData(p,u),!(u&&u.page>0)&&(c.current="promise",m.current=p,g(p))}}),b,P=E.pagination;w.current&&w.current.page>0&&E.data?b=E.data:c.current==="promise"?b=m.current:a&&o!==W?(b=o,P&&(P.hasMore=!0,P.pageSize=o.length)):a&&o===W?b=m.current:o!==W?(b=o,P&&(P.hasMore=!0,P.pageSize=o.length)):b=t;let y=x(b),d=(0,i.useCallback)(async(p,u)=>{let k;try{if(u?.optimisticUpdate){typeof u?.rollbackOnError!="function"&&u?.rollbackOnError!==!1&&(k=structuredClone(y.current));let A=u.optimisticUpdate(y.current);c.current="cache",m.current=A,g(A)}return await T(p,{shouldRevalidateAfter:u?.shouldRevalidateAfter})}catch(A){if(typeof u?.rollbackOnError=="function"){let z=u.rollbackOnError(y.current);c.current="cache",m.current=z,g(z)}else u?.optimisticUpdate&&u?.rollbackOnError!==!1&&(c.current="cache",m.current=k,g(k));throw A}},[g,T,y,m,c]);return(0,i.useEffect)(()=>{o!==W&&(c.current="cache",m.current=o)},[o]),{data:b,isLoading:E.isLoading,error:E.error,mutate:w.current&&w.current.page>0?T:d,pagination:P,revalidate:_}}var le=(function(r){return r.Required="required",r})({});function J(r,n){if(r){if(typeof r=="function")return r(n);if(r==="required"){let e=typeof n<"u"&&n!==null;if(e)switch(typeof n){case"string":e=n.length>0;break;case"object":Array.isArray(n)?e=n.length>0:n instanceof Date&&(e=n.getTime()>0);break;default:break}if(!e)return"The item is required"}}}function ue(r){let{onSubmit:n,validation:e,initialValues:t={}}=r,[a,l]=(0,i.useState)(t),[s,c]=(0,i.useState)({}),o=(0,i.useRef)({}),g=x(e||{}),m=x(n),w=(0,i.useCallback)(y=>{o.current[y]?.focus()},[o]),T=(0,i.useCallback)(async y=>{let d=!1;for(let[u,k]of Object.entries(g.current)){let A=J(k,y[u]);A&&(d||(d={},w(u)),d[u]=A)}if(d)return c(d),!1;let p=await m.current(y);return typeof p=="boolean"?p:!0},[g,m,w]),_=(0,i.useCallback)((y,d)=>{c(p=>({...p,[y]:d}))},[c]),E=(0,i.useCallback)(function(y,d){l(p=>({...p,[y]:typeof d=="function"?d(p[y]):d}))},[l]),b=(0,i.useMemo)(()=>new Proxy({},{get(y,d){let p=g.current[d],u=a[d];return{onChange(k){s[d]&&(J(p,k)||_(d,void 0)),E(d,k)},onBlur(k){let A=J(p,k.target.value);A&&_(d,A)},error:s[d],id:d,value:typeof u>"u"?null:u,ref:k=>{o.current[d]=k}}}}),[s,g,_,a,o,E]),P=(0,i.useCallback)(y=>{c({}),Object.entries(o.current).forEach(([d,p])=>{y?.[d]||p?.reset()}),y&&l(y)},[l,c,o]);return{handleSubmit:T,setValidationError:_,setValue:E,values:a,itemProps:b,focus:w,reset:P}}var v=require("@raycast/api"),L=require("react/jsx-runtime");function fe(r){return function(e){let{isLoading:t,data:a}=q(Q,[],{failureToastOptions:{title:"Invalid API Key",message:"Invalid API key. Please check your API key in preferences. Get a new one from https://supermemory.link/raycast"}});return a?(0,L.jsx)(r,{...e}):t?(0,L.jsx)(v.Detail,{isLoading:!0}):(0,L.jsx)(v.List,{children:(0,L.jsx)(v.List.EmptyView,{icon:v.Icon.ExclamationMark,title:"API Key Required",description:"Please configure your Supermemory API key to search memories",actions:(0,L.jsx)(v.ActionPanel,{children:(0,L.jsx)(v.Action,{title:"Open Extension Preferences",onAction:v.openExtensionPreferences,icon:v.Icon.Gear})})})})}}var S=require("react/jsx-runtime"),je=fe(Me);function Me(){let{isLoading:r,data:n,mutate:e}=ce(Y);return(0,S.jsx)($.List,{isLoading:r,searchBarPlaceholder:"Search your projects",children:!r&&!n?.length?(0,S.jsx)($.List.EmptyView,{title:"No Projects Found",actions:(0,S.jsx)($.ActionPanel,{children:(0,S.jsx)($.Action.Push,{icon:$.Icon.Plus,title:"Create Project",target:(0,S.jsx)(de,{}),onPop:e})})}):n?.map(t=>(0,S.jsx)($.List.Item,{icon:$.Icon.Folder,title:t.name,subtitle:t.description,accessories:[{tag:t.containerTag}],actions:(0,S.jsx)($.ActionPanel,{children:(0,S.jsx)($.Action.Push,{icon:$.Icon.Plus,title:"Create Project",target:(0,S.jsx)(de,{}),onPop:e})})},t.id))})}function de(){let{pop:r}=(0,$.useNavigation)(),[n,e]=(0,he.useState)(!1),{handleSubmit:t,itemProps:a}=ue({async onSubmit(l){e(!0);try{await X(l),r()}catch(s){await H(s,{title:"Failed to add project"})}finally{e(!1)}},validation:{name:le.Required}});return(0,S.jsx)($.Form,{navigationTitle:"Search Projects / Add",isLoading:n,actions:(0,S.jsx)($.ActionPanel,{children:(0,S.jsx)($.Action.SubmitForm,{icon:$.Icon.Plus,title:"Create Project",onSubmit:t})}),children:(0,S.jsx)($.Form.TextField,{title:"Name",placeholder:"My Awesome Project",info:"This will help you organize your memories",...a.name})})}
